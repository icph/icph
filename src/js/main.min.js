function getCookie(cname){for(var name=cname+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1);if(0===c.indexOf(name))return c.substring(name.length,c.length)}return""}function acceptedPrivacy(){return getCookie("privacy")}function authenticate($q,$rootScope,$state,$timeout){return!!bypass_auth||($rootScope.loggedin?$q.when():($timeout(function(){$state.go("welcome.login")}),$q.reject()))}function setupNoConnection(start){start?(response_target_error_start_time=new Date,response_target_error_start_time.setDate(response_target_error_start_time.getDate()+10),start_trigger_no_connection=!0,started_periodic_checking=!1):(start_trigger_no_connection=!1,started_periodic_checking=!1)}function setupPeriodicChecking(start){started_periodic_checking=start}function setResponseErrorTime(has_error){if(has_error){var currentTime=new Date,diffTime=currentTime.getTime()-response_target_error_start_time.getTime();diffTime<0&&(response_target_error_start_time=new Date)}else response_target_error_start_time=new Date,response_target_error_start_time.setDate(response_target_error_start_time.getDate()+10)}function checkResponseErrorReport(){var currentTime=new Date,diffTime=currentTime.getTime()-response_target_error_start_time.getTime(),diffTimeInSeconds=diffTime/1e3;return!started_periodic_checking||diffTimeInSeconds>=180}config_sensor={broker:{host:null,wssPort:9002,wsPort:9001,topic:"/sensors",reconnectTimeout:5e3,reconnectInterval:3},charts:[{title:"Temperature",chartType:"line",units:"F",min:"0",max:"100",targetLow:"30",targetHigh:"60",points:"50"},{title:"Humidity",chartType:"gauge",units:"%",min:"0",max:"100",targetLow:"30",targetHigh:"60",points:"1"}]};var gui_version="2.0.0",bypass_auth=!1,log_messages=!1,log_message_json=!1,license_duration_days=7300,network_check_interval_milliseconds=6e4,rest_check_interval_milliseconds_s=1e3,rest_check_interval_milliseconds=2e3,rest_check_interval_milliseconds_m=5e3,rest_check_interval_milliseconds_l=1e4,rest_check_interval_milliseconds_ll=6e4,reboot_request_timeout_milliseconds=2e4,toggle_security_timeout_milliseconds=35e3,html_content_timeout_milliseconds=1e4,linger_info_timeout_milliseconds=6e3,restart_welcome_latency_milliseconds=13e3,factory_reset_welcome_latency_milliseconds=3e4,length_of_line_graph_history=30,simulate_network_failure=!1,network_index=0,min_password_length=3,no_local_config_hosts=["golden"],requested_url=window.location.hash.substr(1),modal_light_dismiss_enabled="static",https_port="3092",quark_name_string="Quark",start_trigger_no_connection=!0,started_periodic_checking=!1,response_target_error_start_time=new Date,authorization={nc_count:0,username:"",ha1:"",cnonce:"",realm:"",nonce:"",opaque:"",qop:""},periodicCheckNetworkFunc=null,do_validate_session=!0,oem_branding_logo_file="",oem_branding_eulas=[],oem_branding_eulas_datetime=[],oem_branding_cookies_names=[],isLoadingErrorModalShown=!1,iotgatewayhub=angular.module("iotgatewayhub",["ui.router","ui.bootstrap","ngPasswordStrength","chart.js","perfect_scrollbar","timer"]).config(["$stateProvider","$urlRouterProvider","$httpProvider",function($stateProvider,$urlRouterProvider,$httpProvider){var accepted_privacy=acceptedPrivacy();accepted_privacy?$urlRouterProvider.otherwise("/welcome/login"):$urlRouterProvider.otherwise("/welcome/privacy"),$httpProvider.interceptors.push("httpRequestsInterceptor")}]).factory("mqttClient",[function(){var client={};client.connect=function(){};var factory={};return factory.get=function(){return client},factory}]).run(function($rootScope,$state,$location,$window,$uibModal,httpRequestsService){function resolveFromUrl(url){for(var states=$state.get(),i=0,len=states.length;i<len;i++)if(states[i]&&states[i].url===url)return states[i].name}var accepted_privacy=acceptedPrivacy();accepted_privacy?requested_url&&requested_url.indexOf("dashboard")>-1&&($rootScope.redirectState=resolveFromUrl(requested_url)):$location.path("/welcome/privacy"),$rootScope.$on("$locationChangeStart",function(event){acceptedPrivacy()||$location.path("/welcome/privacy")}),$rootScope.$on("Gateway_Not_Reachable",function(event){httpRequestsService.abortAllRequests();var no_connection_template='<div class="admin-step"><div class="row"><div class="col-md-12"><h1>IntelÂ® IoT Gateway Developer Hub cannot reach the gateway!</h1></div></div><div class="row"><div class="col-md-12"><div class="description">Please check gateway status, network connection, and then refresh or try again later. Warning: Your previous task may still be running on the gateway, and IoT Gateway Developer Hub may not reflect its running status.</div></div></div><!-- .row --><div class="row admin-modal-btn-row"><div class="col-md-12"><div class="row"><div class="blue-button-md admin-modal-btn center-button" ng-click="clickRefresh()">Refresh</div></div></div></div><!-- .row --></div>',modalInstance=$uibModal.open({template:no_connection_template,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,controller:function($scope,$window){$scope.clickRefresh=function(){modalInstance.dismiss("cancel"),$window.location.reload()}}})})});iotgatewayhub.directive("hubDashboardLinegraph",function(){return{restrict:"E",templateUrl:"partials/hub.dashboard.linegraph.ng.html?version="+gui_version,replace:!0,scope:{latestData:"=",scaleSteps:"=",scaleStepWidth:"=",scaleStartValue:"=",pointsToShow:"=",units:"=",connected:"="},link:function($scope,$elem,attrs){$scope.connected=!0;var setOptions=function(){var overrideScale=null!==$scope.scaleSteps&&void 0!==$scope.scaleSteps&&null!==$scope.scaleStepWidth&&void 0!==$scope.scaleStepWidth&&null!==$scope.scaleStartValue&&void 0!==$scope.scaleStartValue;$scope.options={animation:!1,showScale:!0,showTooltips:!1,maintainAspectRatio:!1,scaleOverride:overrideScale,scaleSteps:parseInt($scope.scaleSteps),scaleStepWidth:parseFloat($scope.scaleStepWidth),scaleStartValue:parseFloat($scope.scaleStartValue),scaleFontColor:"#ffffff",emptyDataMessage:" ",scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,scaleShowHorizontalLines:!0,scaleShowVerticalLines:!1,scaleType:"date",useUtc:!1,scaleTimeFormat:" ",bezierCurve:!0,bezierCurveTension:.4,pointDot:!1,pointDotRadius:2,pointDotStrokeWidth:1,pointHitDetectionRadius:1,datasetStroke:!0,datasetStrokeWidth:3,datasetFill:!1,legendTemplate:"<div></div>"}},trimHistory=function(){for(;$scope.scatterChart.datasets[0].points.length>$scope.pointsToShow;)$scope.scatterChart.datasets[0].removePoint(0),$scope.dataHistory[0].data.shift()};$scope.dataHistory=[{label:"",strokeColor:"#ffffff",data:[{x:$scope.latestData.x,y:$scope.latestData.y}]}],setOptions();var chartCanvasFind=$elem.find("canvas"),canvasContext=chartCanvasFind[0].getContext("2d");$scope.scatterChart=new Chart(canvasContext).Scatter($scope.dataHistory,$scope.options),null!==$scope.latestData&&void 0!==$scope.latestData&&($scope.scatterChart.datasets[0].addPoint($scope.latestData.x,$scope.latestData.y),$scope.dataHistory[0].data.push({x:$scope.latestData.x,y:$scope.latestData.y})),$scope.series=[""],$scope.$watchGroup(["scaleStepWidth","scaleStartValue","scaleSteps"],function(){setOptions(),$scope.scatterChart.destroy(),$scope.scatterChart=new Chart(canvasContext).Scatter($scope.dataHistory,$scope.options)}),$scope.$watch("latestData",function(){null!==$scope.latestData&&void 0!==$scope.latestData&&($scope.scatterChart.datasets[0].addPoint($scope.latestData.x,$scope.latestData.y),$scope.dataHistory[0].data.push({x:$scope.latestData.x,y:$scope.latestData.y})),trimHistory(),$scope.scatterChart.update()}),$scope.$watch("pointsToShow",function(){trimHistory(),$scope.scatterChart.update()}),$scope.$watch("connected",function(){$scope.connected?$scope.dataHistory[0].strokeColor="#ffffff":$scope.dataHistory[0].strokeColor="#7f868c",$scope.scatterChart.destroy(),$scope.scatterChart=new Chart(canvasContext).Scatter($scope.dataHistory,$scope.options)}),setOptions()}}}),iotgatewayhub.directive("hubDashboardRadialGraph",function(){return{restrict:"E",templateUrl:"partials/hub.dashboard.radialgraph.ng.html?version="+gui_version,replace:!0,scope:{data:"=",units:"=",upperRange:"=",lowerRange:"=",connected:"="},link:function($scope,$elem,attrs){function createDataPair(){$scope.dataPair=[$scope.upperRange-$scope.lowerRange-$scope.data,$scope.data]}$scope.$watch("data",function(){createDataPair()}),$scope.options={showTooltips:!1,segmentShowStroke:!0,segmentStrokeColor:"#003c71",segmentStrokeWidth:4,percentageInnerCutout:80,animationSteps:10,animationEasing:"easeOutBounce",animateRotate:!1,animateScale:!1},$scope.doughnutColors=["#003c71","#8DC449"],$scope.labels=["",""],$scope.$watch("connected",function(){$scope.connected?$scope.doughnutColors=["#003c71","#8DC449"]:$scope.doughnutColors=["#003c71","#7f868c"]})}}}),iotgatewayhub.directive("hubDashboardSensor",function(){return{restrict:"E",templateUrl:"partials/hub.dashboard.sensor.ng.html?version="+gui_version,link:function($scope,elem,attrs){}}}),iotgatewayhub.directive("hubLoading",function(){return{restrict:"E",templateUrl:"partials/hub.loading.ng.html?version="+gui_version,controller:function($scope,$http){$scope.loadMessage="Loading..",$scope.showMessage=!0}}}),iotgatewayhub.directive("hubNetworkSettings",function(){return{url:"/hub/networksettings",templateUrl:"/partials/hub.networksettings.ng.html?version="+gui_version,resolve:{},controller:function($scope,$state,$http,$rootScope,$timeout,workerProcessRestService){function init(){authorization.username||$state.go("welcome.login",{});var defaults={saveText:"Ok",cancelText:"Cancel",insideModal:!1,hideTestSettings:!0,maintainContextAfterSave:!1};$scope.cancelText&&(defaults.cancelText=$scope.cancelText),$.extend($scope,defaults,{isSaving:!1,barMessage:"Saving network settings and adding Wind River repositories if needed. This may take a few minutes.",isUpdatingChannelsFailed:!1,showSaveResult:!1,networkSettingsTest:{running:!1,status:"Test settings",result:"",success:null,isVisible:!1},saveResult:{message:"",success:null,isVisible:!1}})}$scope.tmpSettings={single_url:$scope.settings.proxy.single_url,single_port:$scope.settings.proxy.single_port,http_url:$scope.settings.proxy.http_url,http_port:$scope.settings.proxy.http_port,https_url:$scope.settings.proxy.https_url,https_port:$scope.settings.proxy.https_port,ftp_url:$scope.settings.proxy.ftp_url,ftp_port:$scope.settings.proxy.ftp_port,socks_url:$scope.settings.proxy.socks_url,socks_port:$scope.settings.proxy.socks_port,no_proxy:$scope.settings.proxy.no_proxy},init(),$scope.onSaveSuccess=function(result){$scope.isSaving=!1,$scope.saveResult.isVisible=!0,$scope.saveResult.success=!0,$scope.saveResult.message="Saved settings",$timeout(function(){$scope.saveResult.isVisible=!1},linger_info_timeout_milliseconds)},$scope.onSaveFail=function(result){$scope.$emit("hub.unlockModal"),$scope.isSaving=!1,$scope.saveResult.isVisible=!0,$scope.saveResult.success=!1,$scope.saveResult.message=result.message,$timeout(function(){$scope.saveResult.isVisible=!1},linger_info_timeout_milliseconds)},$scope.nextAction=function(){function successApplyProxySettings(response){$scope.barMessage="Refreshing the installed package list. This may take a few minutes.",tempURL="/api/repository",workerProcessRestService.performGeneralExecution("PUT",tempURL,!0,!1,null,function(data){try{var p_list=JSON.parse(data.p_list);$scope.connected?$scope.setPackages("True",p_list):$scope.setPackages("False",p_list)}catch(err){}$scope.$emit("hub.unlockModal"),$scope.maintainContextAfterSave?$scope.onSaveSuccess(response):$scope.doneSuccessCallback(response)},function(errorMessage){$scope.$emit("hub.unlockModal"),$scope.barMessage=errorMessage,$scope.isUpdatingChannelsFailed=!0},rest_check_interval_milliseconds_m)}$scope.$emit("hub.lockModal",[$scope]),$scope.isSaving=!0,$scope.settings.proxy=$scope.tmpSettings,$scope.applyProxySettings(successApplyProxySettings,$scope.onSaveFail)},$scope.testProxySettingsCallback=function(result){$scope.networkSettingsTest.result=result?"Connection established!":"Connection failed.",$scope.networkSettingsTest.success=!!result,$scope.networkSettingsTest.running=!1,$timeout(function(){$scope.networkSettingsTest.isVisible=!1,$scope.networkSettingsTest.success=!1},linger_info_timeout_milliseconds)},$scope.testSettings=function(){$scope.networkSettingsTest.isVisible=!0,$scope.networkSettingsTest.running=!0,$scope.networkSettingsTest.result="Testing..",$scope.testProxySettings(function(){$scope.testProxySettingsCallback(!0)},function(){$scope.testProxySettingsCallback(!1)})}}}}),iotgatewayhub.directive("showOemOnLoad",function(){return{restrict:"A",link:function(scope,element,attrs){element.bind("load",function(){scope.hideOEMBranding=!1})}}}),iotgatewayhub.directive("psMouseOver",function(){return{link:function(scope,element){element.bind("mouseover",function(e){e.stopPropagation(),e.preventDefault(),element.perfectScrollbar("update")})}}}),iotgatewayhub.directive("shakeThat",["$animate",function($animate){return{require:"^form",scope:{submit:"&",submitted:"="},link:function(scope,element,attrs,form){element.on("submit",function(){scope.$apply(function(){return form.$valid?scope.submit():(scope.submitted=!0,void $animate.addClass(element,"shake",function(){$animate.removeClass(element,"shake")}))})})}}}]),iotgatewayhub.service("httpRequestsService",function($q){function customTimeout(){var newPromise=$q.defer();return toBeAbortedPromises.push(newPromise),newPromise.promise}function abortAllRequests(){angular.forEach(toBeAbortedPromises,function(eachPromise){eachPromise.promise.isAbortedByUs=!0,eachPromise.resolve()}),toBeAbortedPromises.length=0}function removeRequest(response){try{if("number"==typeof response.config.timeout)return;if(void 0===response.config.timeout)return;var target_index=-1,count=0;angular.forEach(toBeAbortedPromises,function(eachPromise){eachPromise.promise===response.config.timeout&&(target_index=count),count+=1}),target_index>-1&&toBeAbortedPromises.splice(target_index,1)}catch(err){}}var toBeAbortedPromises=[];return{customTimeout:customTimeout,abortAllRequests:abortAllRequests,removeRequest:removeRequest}}),iotgatewayhub.factory("httpRequestsInterceptor",["$rootScope","$q","httpRequestsService",function($rootScope,$q,httpRequestsService){return{request:function(config){return config=config||{},"string"==typeof config.url&&config.url.indexOf(".ng.html")>-1&&(config.timeout=html_content_timeout_milliseconds),void 0===config.timeout&&(config.timeout=httpRequestsService.customTimeout()),config},response:function(response){return setResponseErrorTime(!1),httpRequestsService.removeRequest(response),response},responseError:function(rejection){if(rejection.config.timeout.isAbortedByUs)return $q.defer().promise;if(httpRequestsService.removeRequest(rejection),setResponseErrorTime(rejection.status===-1||401===rejection.status||408===rejection.status?!0:!1),rejection.status===-1&&start_trigger_no_connection){var to_report=checkResponseErrorReport();to_report&&$rootScope.$broadcast("Gateway_Not_Reachable")}return $q.reject(rejection)}}}]),iotgatewayhub.factory("utilityFunctionsService",["$http",function($http){var utilityFunctionsService={};return utilityFunctionsService.isNumber=function(n){return!isNaN(parseFloat(n))&&isFinite(n)},utilityFunctionsService.pad=function(n,width,z){return z=z||"0",n+="",n.length>=width?n:new Array(width-n.length+1).join(z)+n},utilityFunctionsService.parse_digest=function(_header){var ws="(?:(?:\\r\\n)?[ \\t])+",token="(?:[\\x21\\x23-\\x27\\x2A\\x2B\\x2D\\x2E\\x30-\\x39\\x3F\\x41-\\x5A\\x5E-\\x7A\\x7C\\x7E]+)",quotedString='"(?:[\\x00-\\x0B\\x0D-\\x21\\x23-\\x5B\\\\x5D-\\x7F]|'+ws+'|\\\\[\\x00-\\x7F])*"',tokenizer=RegExp(token+"(?:=(?:"+quotedString+"|"+token+"))?","g"),tokens=_header.match(tokenizer);return tokens},utilityFunctionsService.unq=function(quotedString){return quotedString.substr(1,quotedString.length-2).replace(/(?:(?:\r\n)?[ \t])+/g," ")},utilityFunctionsService.setCookie=function(cname,cvalue,exdays){var d=new Date;d.setTime(d.getTime()+24*exdays*60*60*1e3);var expires="expires="+d.toUTCString();document.cookie=cname+"="+cvalue+"; "+expires},utilityFunctionsService.checkNetwork=function(_successCallback,_errorCallback){$http({method:"GET",url:"/api/proxy?request=test&nocache="+(new Date).getTime(),cache:!1}).then(_successCallback,_errorCallback)},utilityFunctionsService}]),iotgatewayhub.factory("workerProcessRestService",["$http","$uibModal","$rootScope",function($http,$uibModal,$rootScope){function createWorkID(){var randomNum=Math.random();return randomNum.toString()}function checkPeriodicCheckingResponseError(response){var report=!1,return_message="";return response.status===-1||408===response.status||401===response.status?(report=checkResponseErrorReport(),return_message=report?response.status===-1?"Cannot connect to the gateway server anymore!":408===response.status?"The request got timeout error: http status is 408!":401===response.status?"The request got access denied: http status is 401!":"":""):return_message="Something went wrong: HTTP response status is "+response.status,return_message}function informGeneralError(titleMessage,descMessage,barBeforeMessage){var modalInstance=$uibModal.open({templateUrl:"partials/hub.inform.general.checking.inprogress.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,controller:function($scope,$state,$http,$rootScope){$scope.title_message=titleMessage,$scope.description_message=descMessage,$scope.bar_before_message=barBeforeMessage,$scope.hasError=!0,$scope.closeModal=function(){modalInstance.dismiss("cancel")}}})}var workerProcessRestService={};return workerProcessRestService.informGeneralChecking=function(httpMethod,httpURL,noParameter,httpJSON,httpBody,titleMessage,descMessage,barBeforeMessage,realSuccessCallback,checkPeriod){var modalInstance=$uibModal.open({templateUrl:"partials/hub.inform.general.checking.inprogress.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,controller:function($scope,$state,$http,$rootScope){function periodicChecking(){var http_call={method:httpMethod};httpJSON===!0?(httpBody.id=workID,httpBody.is_checking="True",http_call.url=httpURL,http_call.headers={"Content-type":"application/json"},http_call.data=JSON.stringify(httpBody)):"GET"===httpMethod?noParameter===!0?http_call.url=httpURL+"?is_checking=True&id="+workID+"&nocache="+(new Date).getTime():http_call.url=httpURL+"&is_checking=True&id="+workID+"&nocache="+(new Date).getTime():noParameter===!0?http_call.url=httpURL+"?is_checking=True&id="+workID:http_call.url=httpURL+"&is_checking=True&id="+workID,$http(http_call).then(function(response){"success"===response.data.status?(setupPeriodicChecking(!1),realSuccessCallback(response.data),modalInstance.dismiss("cancel")):"untrusted"===response.data.status?(setupPeriodicChecking(!1),realSuccessCallback(response.data),modalInstance.dismiss("cancel")):response.data.in_progress===!0?(setupPeriodicChecking(!0),setTimeout(periodicChecking,checkPeriod)):(setupPeriodicChecking(!1),informGeneralError(titleMessage,descMessage,"The operation failed! "+response.data.message),modalInstance.dismiss("cancel"))},function(response){var temp_error_message=checkPeriodicCheckingResponseError(response);temp_error_message?(setupPeriodicChecking(!1),informGeneralError(titleMessage,descMessage,temp_error_message),modalInstance.dismiss("cancel")):(setupPeriodicChecking(!0),setTimeout(periodicChecking,checkPeriod))})}$scope.title_message=titleMessage,$scope.description_message=descMessage,$scope.bar_before_message=barBeforeMessage,$scope.hasError=!1;var workID=createWorkID(),http_call={method:httpMethod};httpJSON===!0?(httpBody.id=workID,httpBody.is_checking="False",http_call.url=httpURL,http_call.headers={"Content-type":"application/json"},http_call.data=JSON.stringify(httpBody)):"GET"===httpMethod?noParameter===!0?http_call.url=httpURL+"?is_checking=False&id="+workID+"&nocache="+(new Date).getTime():http_call.url=httpURL+"&is_checking=False&id="+workID+"&nocache="+(new Date).getTime():noParameter===!0?http_call.url=httpURL+"?is_checking=False&id="+workID:http_call.url=httpURL+"&is_checking=False&id="+workID,$http(http_call).then(function(response){if("success"===response.data.status)setupPeriodicChecking(!0),setTimeout(periodicChecking,checkPeriod);else if(response.data.in_progress===!0){var error_message=response.data.work_type+" (run by another user) is still in progress!";informGeneralError(titleMessage,descMessage,error_message),modalInstance.dismiss("cancel")}else informGeneralError(titleMessage,descMessage,"The operation failed! "+response.data.message),modalInstance.dismiss("cancel")},function(response){informGeneralError(titleMessage,descMessage,"Something went wrong: HTTP status "+response.status),modalInstance.dismiss("cancel")})}})},workerProcessRestService.performGeneralExecution=function(httpMethod,httpURL,noParameter,httpJSON,httpBody,passedSuccessCallback,passedErrorCallback,checkPeriod){function periodicChecking(){var http_call={method:httpMethod};httpJSON===!0?(httpBody.id=workID,httpBody.is_checking="True",http_call.url=httpURL,http_call.headers={"Content-type":"application/json"},http_call.data=JSON.stringify(httpBody)):"GET"===httpMethod?noParameter===!0?http_call.url=httpURL+"?is_checking=True&id="+workID+"&nocache="+(new Date).getTime():http_call.url=httpURL+"&is_checking=True&id="+workID+"&nocache="+(new Date).getTime():noParameter===!0?http_call.url=httpURL+"?is_checking=True&id="+workID:http_call.url=httpURL+"&is_checking=True&id="+workID,$http(http_call).then(function(response){if("success"===response.data.status)setupPeriodicChecking(!1),passedSuccessCallback(response.data);else if("untrusted"===response.data.status)setupPeriodicChecking(!1),passedSuccessCallback(response.data);else if(response.data.in_progress===!0)setupPeriodicChecking(!0),setTimeout(periodicChecking,checkPeriod);else{setupPeriodicChecking(!1);var error_message=response.data.message;passedErrorCallback(error_message)}},function(response){var temp_error_message=checkPeriodicCheckingResponseError(response);temp_error_message?(setupPeriodicChecking(!1),passedErrorCallback(temp_error_message)):(setupPeriodicChecking(!0),setTimeout(periodicChecking,checkPeriod))})}var workID=createWorkID(),http_call={method:httpMethod};httpJSON===!0?(httpBody.id=workID,httpBody.is_checking="False",http_call.url=httpURL,http_call.headers={"Content-type":"application/json"},http_call.data=JSON.stringify(httpBody)):"GET"===httpMethod?noParameter===!0?http_call.url=httpURL+"?is_checking=False&id="+workID+"&nocache="+(new Date).getTime():http_call.url=httpURL+"&is_checking=False&id="+workID+"&nocache="+(new Date).getTime():noParameter===!0?http_call.url=httpURL+"?is_checking=False&id="+workID:http_call.url=httpURL+"&is_checking=False&id="+workID,$http(http_call).then(function(response){"success"===response.data.status?(setupPeriodicChecking(!0),setTimeout(periodicChecking,checkPeriod)):response.data.in_progress===!0?(setupPeriodicChecking(!1),passedErrorCallback(response.data.work_type+" (run by another user) is still in progress! Please try again later!")):(setupPeriodicChecking(!1),passedErrorCallback(response.data.message))},function(response){setupPeriodicChecking(!1),passedErrorCallback("Something went wrong: HTTP status "+response.status)})},workerProcessRestService.performGeneralExecutionOnlySubmit=function(httpMethod,httpURL,noParameter,httpJSON,httpBody,passedSuccessCallback,passedErrorCallback){var workID=createWorkID(),http_call={method:httpMethod};httpJSON===!0?(httpBody.id=workID,httpBody.is_checking="False",http_call.url=httpURL,http_call.headers={"Content-type":"application/json"},http_call.data=JSON.stringify(httpBody)):"GET"===httpMethod?noParameter===!0?http_call.url=httpURL+"?is_checking=False&id="+workID+"&nocache="+(new Date).getTime():http_call.url=httpURL+"&is_checking=False&id="+workID+"&nocache="+(new Date).getTime():noParameter===!0?http_call.url=httpURL+"?is_checking=False&id="+workID:http_call.url=httpURL+"&is_checking=False&id="+workID,$http(http_call).then(function(response){"success"===response.data.status?(setupPeriodicChecking(!1),passedSuccessCallback(response.data)):response.data.in_progress===!0?(setupPeriodicChecking(!1),passedErrorCallback(response.data.work_type+" (run by another user) is still in progress! Please try again later!")):(setupPeriodicChecking(!1),passedErrorCallback(response.data.message))},function(response){setupPeriodicChecking(!1),passedErrorCallback("Something went wrong: HTTP status "+response.status)})},workerProcessRestService}]),iotgatewayhub.config(function($stateProvider,$urlRouterProvider){$stateProvider.state("error",{url:"/error",templateUrl:"/partials/error.ng.html?version="+gui_version,controller:function($scope,$state,$http,$rootScope){}})}),iotgatewayhub.config(function($stateProvider,$urlRouterProvider){$stateProvider.state("hub.dashboard.cloudcmd",{url:"/cloudcmd",templateUrl:"/partials/hub.cloudcmd.ng.html?version="+gui_version,controller:function($window,$scope,$state,$rootScope){}})}),iotgatewayhub.config(function($stateProvider,$urlRouterProvider){$stateProvider.state("hub.dashboard.documentation",{url:"/dashboard/documentation",templateUrl:"/partials/hub.dashboard.documentation.ng.html?version="+gui_version,controller:function($scope,$state,$http,$rootScope){$scope.viewTutorial=function(tutorial_html){$scope.isQuark&&"tutorial.savedeploy"==tutorial_html&&(tutorial_html="tutorial.savedeploy_quark");var url=$state.href(tutorial_html,{parameter:"parameter"});window.open(url,"_blank")},$scope.viewSensorSetupTutorial=function(){var url=$state.href("tutorial.sensorsetup",{parameter:"parameter"});window.open(url,"_blank")},$scope.viewSensorCloudTutorial=function(){var url=$state.href("tutorial.sensorcloud",{parameter:"parameter"});window.open(url,"_blank")},$scope.viewHelixTutorial=function(){var url=$state.href("tutorial.helixapp",{parameter:"parameter"});window.open(url,"_blank")},$scope.viewSaveDeployTutorial=function(){var state_chosen="tutorial.savedeploy";$scope.isQuark&&(state_chosen="tutorial.savedeploy_quark");var url=$state.href(state_chosen,{parameter:"parameter"});window.open(url,"_blank")}}})}),iotgatewayhub.config(function($stateProvider,$urlRouterProvider){$stateProvider.state("hub.dashboard",{url:"","abstract":!0,templateUrl:"/partials/hub.dashboard.ng.html?version="+gui_version,controller:function($window,$scope,$state,$rootScope,$timeout){$scope.timerExpired=function(chartMatch){chartMatch.connected=!1,$scope.$apply()},$rootScope.isSensorPanelExpanded=!0,$scope.checkElement=function(el){return"undefined"!=typeof el&&null!==el&&""!==el},$scope.sensors_charted=[],$scope.charts_flat_list=[],$scope.dashboardToggle=function(){$rootScope.isSensorPanelExpanded=!$rootScope.isSensorPanelExpanded},$scope.carouselPrevious=function(){},$scope.carouselNext=function(){},$scope.setDashboard(),$scope.onConnectionLost=function(responseObject){0!==responseObject.errorCode},$scope.countTabs=function(){var tab_count=0;return"enabled"==$scope.device.sensor_config&&tab_count++,"enabled"==$scope.device.softsoc_config&&tab_count++,"enabled"==$scope.device.ref_sw_config&&tab_count++,"enabled"==$scope.device.package_config&&tab_count++,"enabled"==$scope.device.admin_config&&tab_count++,"enabled"==$scope.device.documentation_config&&tab_count++,tab_count},$scope.onMessageArrived=function(message){try{var sensorMatch,entry=JSON.parse(message.payloadString),_id=entry.id,sensorMatches=$.grep($scope.sensors_charted,function(e){return e.id==_id});sensorMatches.length>1||(1==sensorMatches.length?sensorMatch=sensorMatches[0]:(sensorMatch={charts:[],id:_id,title:entry.title},$scope.sensors_charted.push(sensorMatch)),sensorMatch.mostRecentValue=entry.datum[1],sensorMatch.priority=parseInt(entry.priority),sensorMatch.mostRecentUnits=entry.units,sensorMatch.mostRecentSource=entry.dataSource,sensorMatch.mostRecentTimestamp=new Date(parseInt(entry.datum[0])));var chartMatch,chartMatches=$.grep(sensorMatch.charts,function(e){return e.dataSource==entry.dataSource});chartMatches.length>1||(1==chartMatches.length?chartMatch=chartMatches[0]:(chartMatch={},sensorMatch.charts.push(chartMatch),$scope.charts_flat_list.push(chartMatch))),chartMatch.parentSensorTitle=sensorMatch.title,chartMatch.chartType=entry.chartType,"line"==entry.chartType?chartMatch.value={x:entry.datum[0],y:entry.datum[1]}:chartMatch.value=entry.datum[1],chartMatch.mostRecentValue=entry.datum[1],chartMatch.sourcePriority=parseInt(entry.sourcePriority),chartMatch.dataSource=entry.dataSource,chartMatch.min=entry.min,chartMatch.max=entry.max,chartMatch.stepWidth=(entry.max-entry.min)/5,chartMatch.pointsToShow=parseInt(entry.points),chartMatch.units=entry.units,chartMatch.timeToLive=parseFloat(entry.ttl),chartMatch.connected=!0,chartMatch.mostRecentTimestamp=new Date(parseInt(entry.datum[0])),chartMatch.timerExpiredPromise&&$timeout.cancel(chartMatch.timerExpiredPromise),chartMatch.timerExpiredPromise=$timeout(function(){$scope.timerExpired(chartMatch)},1e3*chartMatch.timeToLive),$scope.$apply()}catch(err){}},$scope.mqttInit=function(){var loop=0,reconnect=!1,_host=null!==$window.config_sensor.broker.host?$window.config_sensor.broker.host:window.location.hostname;no_local_config_hosts&&no_local_config_hosts.indexOf(window.location.hostname)!=-1&&(_host=window.location.hostname);var _useSSL=!1,_port=$window.config_sensor.broker.wsPort;"https:"===window.location.protocol&&(_port=$window.config_sensor.broker.wssPort,_useSSL=!0);var _id="client_"+parseInt(100*Math.random(),10),_reconnectInterval=$window.config_sensor.broker.reconnectInterval,_reconnectTimeout=$window.config_sensor.broker.reconnectTimeout,_topic=$window.config_sensor.broker.topic;$scope.mqtt_client=new $window.Paho.MQTT.Client(_host,_port,_id),$scope.mqtt_client.onConnectionLost=$scope.onConnectionLost,$scope.mqtt_client.onMessageArrived=$scope.onMessageArrived,$scope.mqtt_client.connect({useSSL:_useSSL,timeout:3,cleanSession:!0,onSuccess:function(){$scope.mqtt_client.subscribe(_topic,{qos:1})},onFailure:function(message){function initMqtt(){$scope.mqttInit()}if(reconnect){for(;loop<_reconnectInterval;)loop++,setTimeout(initMqtt,_reconnectTimeout);reconnect=!1}}})},$scope.mqttInit()}})}),iotgatewayhub.config(function($stateProvider,$urlRouterProvider){$stateProvider.state("hub.dashboard.nodered",{url:"/nodered",templateUrl:"/partials/hub.nodered.ng.html?version="+gui_version,controller:function($window,$scope,$state,$rootScope){}}).state("hub.dashboard.helix",{url:"/helix",templateUrl:"/partials/hub.helix.ng.html?version="+gui_version,controller:function($window,$scope,$state,$rootScope){}}).state("hub.dashboard.luci",{url:"/luci",templateUrl:"/partials/hub.luci.ng.html?version="+gui_version,controller:function($window,$scope,$state,$rootScope){}})}),iotgatewayhub.config(function($stateProvider,$urlRouterProvider){$stateProvider.state("hub.dashboard.packages",{url:"/dashboard/packages",templateUrl:"/partials/hub.dashboard.packages.ng.html?version="+gui_version,controller:function($scope,$state,$http,$rootScope,$uibModal){var num_to_show=100;$scope.gettingPackages=!0,$scope.showLoadMore=!1,$scope.sortType="name",$scope.totalDisplayed=num_to_show,$scope.loadMore=function(){$scope.totalDisplayed+=num_to_show,$scope.totalDisplayed>=$scope.installed.length&&($scope.showLoadMore=!1)},"enabled"==$scope.device.package_config&&($scope.connected?$scope.setPackages("True","",function(data){$scope.gettingPackages=!1,$scope.installed.length<=$scope.totalDisplayed?$scope.showLoadMore=!1:$scope.showLoadMore=!0},function(response){$scope.gettingPackages=!1}):$scope.setPackages("False","",function(data){$scope.gettingPackages=!1,$scope.installed.length<=$scope.totalDisplayed?$scope.showLoadMore=!1:$scope.showLoadMore=!0},function(response){$scope.gettingPackages=!1}))}}).state("hub.dashboard.package",{
url:"/package",templateUrl:"/partials/hub.package.ng.html?version="+gui_version,params:{packageUrl:null,packageName:null},controller:function($window,$scope,$state,$rootScope,$stateParams){$scope.packageUrl=$stateParams.packageUrl,$scope.packageName=$stateParams.packageName,$scope.packageUrl||$state.go("hub.dashboard.packages")}})}),iotgatewayhub.config(function($stateProvider,$urlRouterProvider){$stateProvider.state("hub.dashboard.referencesoftware",{url:"/dashboard/referencesoftware",templateUrl:"/partials/hub.dashboard.referencesoftware.ng.html?version="+gui_version,controller:function($scope,$state,$http,$rootScope,$uibModal){var num_to_show=500;$scope.gettingPackages=!0,$scope.showLoadMore=!1,$scope.sortType="name",$scope.totalDisplayed=num_to_show,$scope.loadMore=function(){$scope.totalDisplayed+=num_to_show,$scope.totalDisplayed>=$scope.installed.length&&($scope.showLoadMore=!1)},"enabled"==$scope.device.ref_sw_config&&($scope.connected?$scope.setPackages("True","",function(data){$scope.gettingPackages=!1,$scope.installed.length<=$scope.totalDisplayed?$scope.showLoadMore=!1:$scope.showLoadMore=!0},function(response){$scope.gettingPackages=!1}):$scope.setPackages("False","",function(data){$scope.gettingPackages=!1,$scope.installed.length<=$scope.totalDisplayed?$scope.showLoadMore=!1:$scope.showLoadMore=!0},function(response){$scope.gettingPackages=!1}))}}).state("hub.dashboard.ref",{url:"/ref",templateUrl:"/partials/hub.ref.ng.html?version="+gui_version,params:{packageUrl:null,packageName:null},controller:function($window,$scope,$state,$rootScope,$stateParams){$scope.packageUrl=$stateParams.packageUrl,$scope.packageName=$stateParams.packageName,$scope.packageUrl||$state.go("hub.dashboard.referencesoftware")}})}),iotgatewayhub.config(function($stateProvider,$urlRouterProvider){$stateProvider.state("hub.dashboard.sensors",{url:"/dashboard/sensors",templateUrl:"/partials/hub.dashboard.sensors.ng.html?version="+gui_version,controller:function($window,$scope,$state,$rootScope,$uibModal,utilityFunctionsService){$scope.sortType="parentSensorTitle",$scope.doManageSensors=function(){var _cookie=getCookie("noreshow");_cookie?$scope.launchQuickTools("nodered"):$scope.openManageSensorsDialogModal()},$scope.openManageSensorsDialogModal=function(){var modalInstance=$uibModal.open({templateUrl:"partials/hub.manage.sensors.dialog.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){$scope.noreshow=!0,$scope.closeModal=function(){$scope.noreshow&&utilityFunctionsService.setCookie("noreshow",!0,license_duration_days),modalInstance.dismiss("cancel"),$scope.launchQuickTools("nodered")},$scope.viewTutorial=function(){$scope.noreshow&&utilityFunctionsService.setCookie("noreshow",!0,license_duration_days);var url=$state.href("tutorial.sensorsetup",{parameter:"parameter"});window.open(url,"_blank")},$scope.viewVideo=function(){$scope.noreshow&&utilityFunctionsService.setCookie("noreshow",!0,license_duration_days);var url="https://software.intel.com/en-us/videos/iot-dev-hub-setup-sensor-in-node-red";window.open(url,"_blank")}}})},$scope.openSensorTutorialModal=function(){var url=$state.href("tutorial.sensorsetup",{parameter:"parameter"});window.open(url,"_blank")}}})}),iotgatewayhub.config(function($stateProvider,$urlRouterProvider){$stateProvider.state("hub.dashboard.softsoc",{url:"/dashboard/softsoc",templateUrl:"/partials/hub.dashboard.softsoc.ng.html?version="+gui_version,controller:function($window,$scope,$state,$rootScope,$timeout,$uibModal,utilityFunctionsService){$scope.sortType="parentSensorTitle",$scope.fpgaBuildAndReboot=function(){var modalInstance=$uibModal.open({templateUrl:"partials/hub.confirm.fpga.reboot.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){$scope.cancelFPGA=function(){$scope.fpga_num_comp=0,modalInstance.dismiss("cancel")},$scope.continueFPGA=function(){$scope.showFpgaBuild(),modalInstance.dismiss("cancel")}}})},$scope.setFPGAOption=function(option,enabled){for(var i=0;i<$scope.fpga_num_comp.length;i++)option==$scope.fpga_options[i]&&(enabled===!0?$scope.fpga_num_comp[i]=1:$scope.fpga_num_comp[i]=0)},$scope.fpgaValidateInput=function(){for(var i=0,gui_num_comp=0;i<$scope.fpga_num_comp.length;i++)$scope.fpga_num_comp[i]&&(gui_num_comp+=Math.pow(2,i));for(i=0;i<$scope.fpga_valid_num.length;i++)if(gui_num_comp==$scope.fpga_valid_num[i])return $scope.fpga_package_install_position=i,!0;return!1},$scope.showFpgaBuild=function(){var modalInstance=$uibModal.open({templateUrl:"partials/hub.inform.fpga.build.inprogress.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope,$timeout){$scope.bar_before_message="Building FPGA image",$scope.bar_after_message="Building the FPGA image. Please wait...",$scope.error_message=null,$scope.show_close_button=!1,$scope.installPackage($scope.fpga_options_data[$scope.fpga_package_install_position],function(response){$scope.fpga_num_comp=0,$scope.showFpgaReboot(),$scope.rebootGateway(function(response){$timeout(function(){modalInstance.dismiss("cancel")},restart_welcome_latency_milliseconds-1e3)},function(response){$scope.bar_after_message="Rebooting gateway failed! Please manually restart the gateway!"},restart_welcome_latency_milliseconds),$scope.message="The install was successful. Forwarding to login in 10 seconds...",$timeout(function(){modalInstance.dismiss("cancel")},restart_welcome_latency_milliseconds-1e3)},function(response){modalInstance.dismiss("cancel")},!0),$scope.closeModal=function(){modalInstance.dismiss("cancel")}}})},$scope.showFpgaReboot=function(){var modalInstance=$uibModal.open({templateUrl:"partials/hub.inform.fpga.reboot.inprogress.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope,$timeout){$scope.bar_before_message="System Reboot",$scope.bar_after_message="Rebooting system. Please wait...",$scope.error_message=null,$scope.show_close_button=!1,$scope.closeModal=function(){modalInstance.dismiss("cancel")}}})},$scope.isFPGAImageInstalled=function(option){for(i=0;i<$scope.fpga_options_data.length;i++)if($scope.fpga_options_data[i].installed===!0&&$scope.fpga_options_data[i][option]>0)return!0;return!1}}})}),iotgatewayhub.config(function($stateProvider,$urlRouterProvider){$stateProvider.state("hub.dashboard.tools",{url:"/dashboard/tools",templateUrl:"/partials/hub.dashboard.admin.ng.html?version="+gui_version,controller:function($scope,$state,$rootScope,$uibModal){$scope.confirmRestartOS=function(){var modalInstance=$uibModal.open({templateUrl:"partials/hub.confirm.restart.os.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope,$timeout){$scope.restarting_os=!1,$scope.restarted_os=!1,$scope.message="",$scope.error_message="",$scope.restartOS=function(){$scope.restarting_os||($scope.error_message="",$scope.restarting_os=!0,$scope.restarted_os=!1,$scope.rebootGateway(function(response){$scope.restarting_os=!1,$scope.restarted_os=!0,$scope.message="The reboot process was successful. Forwarding to login in 10 seconds..."},function(response){$scope.error_message="Rebooting gateway failed! Please manually reboot the gateway!"},restart_welcome_latency_milliseconds))},$scope.closeModal=function(){modalInstance.dismiss("cancel")}}})},$scope.configureNetwork=function(){$scope.getProxySettings(function(){$scope.cancelText="Cancel",$scope.isInsideModal=!0,$scope.skipSettings=function(){networkSettingsModal.dismiss()},$scope.doneSuccessCallback=function(){networkSettingsModal.dismiss()};var networkSettingsModal=$uibModal.open({templateUrl:"/partials/hub.networksettings.dashboard.ng.html?version="+gui_version,animation:!0,size:"lg",scope:$scope,backdrop:modal_light_dismiss_enabled});$scope.closeModal=function(){networkSettingsModal.dismiss("cancel")}})},$scope.onClickUpgrade=function(){$scope.suppressReminder=""!==getCookie("upgradeMessage");return $scope.mec.enabled?void $scope.openOSUpgradeModal1b():void $scope.openOSUpgradeModal2()},$scope.onClickSaveOSImage=function(){var suppress=$scope.suppressReminder=""!==getCookie("upgradeMessage");return $scope.pro||suppress?void $scope.openOSImageModal0():void $scope.confirmOSUpgrade($scope.openOSImageModal0)},$scope.openChangePassModal0=function(){var modalInstance=$uibModal.open({templateUrl:"partials/hub.change.password.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http){$scope.error_message=null,$scope.update={username:null,password:null,newpassword:null,confirmnewpassword:null},$scope.closeModal=function(){modalInstance.dismiss("cancel")},$scope.changePassword=function(){$scope.error_message=null;var _username=$scope.update.username,_password=$scope.update.password,_newpassword=$scope.update.newpassword,_confirmnewpassword=$scope.update.confirmnewpassword;!_newpassword||_newpassword.length<3?$scope.error_message="The new password must be at least 3 characters long.":_newpassword!==_confirmnewpassword?$scope.error_message="The new passwords do not match.":$http({method:"PUT",url:"/api/auth",data:JSON.stringify({username:_username,password:_password,newpassword:_newpassword}),headers:{"Content-type":"application/json"}}).then(function(response){"success"===response.data.status?($scope.openConfirmChangePasswordModal(_username),modalInstance.dismiss("cancel")):$scope.error_message="ERROR: "+response.data.error},function(response){$scope.error_message="ERROR: "+response})}}})},$scope.openConfirmChangePasswordModal=function(username){var modalInstance=$uibModal.open({templateUrl:"partials/hub.change.password.confirm.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope){$scope.username=username,$scope.closeModal=function(){modalInstance.dismiss("cancel")}}})},$scope.showFactoryReset=function(){var modalInstance=$uibModal.open({templateUrl:"partials/hub.inform.os.update.inprogress.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope,$timeout){$scope.title_message="Restore Factory OS: Restoring Default Operating System",$scope.description_message="The gateway's original operating system and file system is being restored. This should take several minutes.",$scope.bar_before_message="Restoring Default OS...",$scope.bar_after_message="The gateway will automatically restart once restore is complete.",$scope.error_message=null,$scope.show_close_button=!1,$scope.closeModal=function(){modalInstance.dismiss("cancel")},$scope.doFactoryReset=function(){$scope.error_message=null,$scope.show_close_button=!1,$scope.stopCheckingNetwork(),$http({method:"POST",url:"/api/osc"}).then(function(response){$timeout(function(){do_validate_session=!1,$state.go("welcome.login")},factory_reset_welcome_latency_milliseconds)},function(response){$scope.startCheckingNetwork(),$scope.bar_after_message=null,$scope.error_message="Restoring failed!",$scope.show_close_button=!0,setupNoConnection(!0)})},setupNoConnection(!1),$scope.doFactoryReset()}})},$scope.confirmFactoryReset=function(){var modalInstance=$uibModal.open({templateUrl:"partials/hub.confirm.factory.reset.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope){$scope.cancelFactoryReset=function(){modalInstance.dismiss("cancel")},$scope.doFactoryReset=function(){$scope.showFactoryReset(),modalInstance.dismiss("cancel")}}})}}})}),iotgatewayhub.config(function($stateProvider,$urlRouterProvider){$stateProvider.state("hub",{url:"","abstract":!0,templateUrl:"/partials/hub.ng.html?version="+gui_version,resolve:{authenticate:authenticate},controller:function($window,$scope,$state,$location,$rootScope,$http,$uibModal,$q,$sce,$timeout,workerProcessRestService,utilityFunctionsService){if(setupNoConnection(!1),$scope.security_enabled="https:"===window.location.protocol,oem_branding_logo_file){var oem_branding_logo_full_file=oem_branding_logo_file,temp_index=oem_branding_logo_full_file.lastIndexOf("/"),temp_logo_name=oem_branding_logo_full_file.substring(temp_index+1),temp_logo_path=oem_branding_logo_full_file.substring(0,temp_index+1);temp_logo_name=encodeURIComponent(temp_logo_name),oem_branding_logo_full_file=temp_logo_path+temp_logo_name,$scope.oem_logo_file=oem_branding_logo_full_file,$scope.hideOEMBranding=!1}else $scope.hideOEMBranding=!0;$scope.dashboard=!1,$scope.usb_devices=[],$scope.available=[],$scope.installed=[],$scope.package_updates=[],$scope.updates=0,$scope.sensors=[],$scope.sensor_map={},$scope.upgrades=0,$scope.mec=!1,$scope.isQuark=!0,$scope.fpga_valid_num=[],$scope.fpga_num_comp=[],$scope.fpga_package_install_position=null,$scope.option_descriptions=[],$scope.humidity="",$scope.temperature="",$scope.connected=!1,$scope.pro=!1,$scope.https_port=https_port,$scope.updating_package={},$scope.updated_package={},$scope.update_package_failed={},$scope.update_package_fail_message={},$scope.installing_package={},$scope.uninstalling_package={},$scope.package_activity=!1,$scope.starting_package={},$scope.stopping_package={},$scope.enabling_package={},$scope.installed_package={},$scope.deleting_repository={},$scope.noderedurl=$sce.trustAsResourceUrl(window.location.protocol+"//"+window.location.hostname+":1880"),$scope.luciurl=$sce.trustAsResourceUrl("https://"+window.location.hostname+":443"),$scope.httpurl=$sce.trustAsResourceUrl("http://"+window.location.hostname),$scope.httpsurl=$sce.trustAsResourceUrl("https://"+window.location.hostname+":3092"),$scope.cloudcmdurl=$sce.trustAsResourceUrl(window.location.protocol+"//"+window.location.hostname+":8000"),$scope.foundOSUpdate=!1,$scope.foundOSUpdate_Packages=!1,$scope.OSUpdate_Packages=[],$scope.package_refresh=0,$scope.gotPackagesList=!0,$scope.gotPackagesList_Error=!1,$scope.setDashboard=function(){$scope.dashboard=!0},$scope.isDashboard=function(){return $scope.dashboard},$scope.hasUpdates=function(){return $scope.updates>0},$scope.hasOSUpdate=function(){return!0},$scope.updatePackageStatuses=function(){if(!$scope.package_activity){$scope.package_activity=!0;for(var _i=0,_len=$scope.packages.length;_i<_len;_i++){var _package=$scope.packages[_i],_service=_package.service;if(_service&&_service[0]){for(var _all_services_running=!0,_all_services_enabled=!0,_num_services=_service.length,_j=0;_j<_num_services;_j++){var _service_sub=$scope.service_statuses[_service[_j]].SUB,_service_state=$scope.service_statuses[_service[_j]].State;"Running"!==_service_sub&&(_all_services_running=!1),"enabled"!==_service_state&&(_all_services_enabled=!1)}$scope.package_statuses[_package.name]={running:_all_services_running,autorun:_all_services_enabled},_package.running=_all_services_running,_package.autorun=_all_services_enabled}}$scope.package_activity=!1}},$scope.setArrays=function(_set_services){$scope.packages&&($scope.available=$scope.packages.filter(function(_package){return!_package.installed}),$scope.installed=$scope.packages.filter(function(_package){return _package.installed}),$scope.package_updates=$scope.installed.filter(function(_package){return _package.upgrade_version&&""!==_package.upgrade_version}),$scope.updates=$scope.package_updates.length,$scope.curated=$scope.available.filter(function(_package){return _package.curated}),_set_services&&$scope.setServices())},$scope.launchQuickTools=function(_toolname){var win=null;"nodered"===_toolname?navigator.userAgent.toLowerCase().indexOf("firefox")>-1?(win=window.open($scope.noderedurl,"_blank"),win.focus()):($state.go("hub.dashboard.nodered"),$rootScope.isSensorPanelExpanded=!1):"helix"===_toolname?($state.go("hub.dashboard.helix"),$rootScope.isSensorPanelExpanded=!1):"luci"===_toolname?(win=window.open($scope.luciurl,"_blank"),win.focus()):"cloudcmd"===_toolname&&("https:"===window.location.protocol?(win=window.open($scope.cloudcmdurl,"_blank"),win.focus()):navigator.userAgent.toLowerCase().indexOf("firefox")>-1?(win=window.open($scope.cloudcmdurl,"_blank"),win.focus()):($state.go("hub.dashboard.cloudcmd"),$rootScope.isSensorPanelExpanded=!1))},$scope.setupPreventModalClosing=function(){},$scope.initHubTasks=function(update){function initSetDevice(update){$http({method:"GET",url:"/api/osc?nocache="+(new Date).getTime()}).then(function(response){$scope.device=response.data,$scope.device.model.indexOf(quark_name_string)<=-1?$scope.isQuark=!1:$scope.isQuark=!0;var uptime=$scope.device.uptime.split(" "),days=uptime[0].substr(0,uptime[0].length-1),hours=uptime[1].substr(0,uptime[1].length-1),minutes=uptime[2].substr(0,uptime[2].length-1),milliseconds=60*days*60*24*1e3+60*hours*60*1e3+60*minutes*1e3,upSince=new Date(new Date-milliseconds);$scope.deviceUpSince=upSince.getTime(),"enabled"==$scope.device.documentation_config&&$scope.initGetTutorials(update),"enabled"==$scope.device.softsoc_config&&$scope.initGetFPGA(update)},function(response){})}initSetDevice($scope.connected?"True":"False")},$scope.initGetTutorials=function(update){$http({method:"GET",url:"/api/tutorials?update="+update+"&nocache="+(new Date).getTime()}).then(function(response){$scope.documentation=response.data},function(response){})},$scope.initGetFPGA=function(update){$http({method:"GET",url:"/api/softsoc?update="+update+"&nocache="+(new Date).getTime()}).then(function(response){$scope.fpga_options=response.data[0],$scope.fpga_options_data=response.data[1],$scope.option_descriptions=response.data[2];for(var i=0,numComp=0;i<$scope.fpga_options_data.length;i++){$scope.fpga_num_comp[i]=0;for(var j=0;j<$scope.fpga_options.length;j++)$scope.fpga_options_data[i][$scope.fpga_options[j]]>0&&(numComp+=Math.pow(2,j));$scope.fpga_valid_num[i]=numComp,numComp=0}},function(response){})},iotgatewayhub.expandHub_proxy($scope,$uibModal,$http,$rootScope,$state,workerProcessRestService,utilityFunctionsService),iotgatewayhub.expandHub_services($scope,$http,$q,workerProcessRestService),iotgatewayhub.expandHub_save_image($scope,$http,$uibModal,workerProcessRestService),iotgatewayhub.expandHub_security($scope,$http,$uibModal,workerProcessRestService),iotgatewayhub.expandHub_repositories($scope,$http,$state,$uibModal,workerProcessRestService),iotgatewayhub.expandHub_packages($scope,$state,$http,$rootScope,$uibModal,$timeout,workerProcessRestService),iotgatewayhub.expandHub_pro_upgrade($scope,$http,$state,$uibModal,$timeout,workerProcessRestService,utilityFunctionsService),iotgatewayhub.expandHub_openOSUpdate($scope,$uibModal,$http,workerProcessRestService),iotgatewayhub.expandHub_gatewayOperations($scope,$http,$state,$timeout,$window),$scope.$watchCollection("package_refresh",function(){$scope.setArrays(!0)}),$scope.$on("hub.lockModal",function(scope){blockUI=!0,$(".close-admin-modal").hide(),listener=scope.targetScope.$on("modal.closing",function(event,reason,closed){blockUI&&event.preventDefault()})}),$scope.$on("hub.unlockModal",function(){$(".close-admin-modal").show(),listener()}),$rootScope.$on("$locationChangeStart",function(event){$rootScope.accepted_license||$state.go("hub.license",{})}),$scope.setupPreventModalClosing(),$scope.connected?$scope.initHubTasks("True"):$scope.initHubTasks("False")}})}),iotgatewayhub.config(function($stateProvider,$urlRouterProvider){$stateProvider.state("hub.license",{url:"/hub/license",templateUrl:"/partials/hub.license.ng.html?version="+gui_version,controller:function($scope,$state,$http,$rootScope,utilityFunctionsService){function findUnacceptedCookieIndex(){var temp_index=-1;for(i=0;i<oem_branding_cookies_names.length;i++)if(!getCookie(oem_branding_cookies_names[i])){temp_index=i,all_accepted=!1;break}return temp_index}function checkEulaCookies(doApply){eula_index=findUnacceptedCookieIndex(),eula_index===-1?($rootScope.accepted_license=!0,$state.go("hub.networkcheck")):($scope.eulaLoaded=!1,setTimeout(function(){var temp_eula_full_name=oem_branding_eulas[eula_index],temp_index=temp_eula_full_name.lastIndexOf("/"),temp_eula_name=temp_eula_full_name.substring(temp_index+1),temp_eula_path=temp_eula_full_name.substring(0,temp_index+1);temp_eula_name=encodeURIComponent(temp_eula_name),temp_eula_full_name=temp_eula_path+temp_eula_name,$scope.current_eula_html_file=temp_eula_full_name,$scope.current_eula_cookie_name=oem_branding_cookies_names[eula_index],doApply&&$scope.$apply()},1500))}var eula_index=-1;$scope.eulaLoaded=!1,$scope.cancel=function(){authorization={},$rootScope.loggedin=!1,$state.go("welcome.login",{})},$scope.agree=function(){utilityFunctionsService.setCookie($scope.current_eula_cookie_name,"true",license_duration_days),checkEulaCookies(!0)},authorization.username||$state.go("welcome.login",{}),checkEulaCookies(!0)}})}),iotgatewayhub.config(function($stateProvider,$urlRouterProvider){$stateProvider.state("hub.networkcheck",{url:"/hub/networkcheck",templateUrl:"partials/hub.loading.ng.html?version="+gui_version,controller:function($scope,$state,$http,$rootScope){authorization.username||$state.go("welcome.login",{}),setupNoConnection(!0),$scope.loadMessage="Checking network connection, and if needed, adding repositories and building packages list. This may take a few minutes.",$scope.showMessage=!0,setTimeout(function(){$scope.proceedToNetworkCheck()},1e3)}})}),iotgatewayhub.config(function($stateProvider,$urlRouterProvider){$stateProvider.state("hub.networkconnected",{url:"/hub/networkconnected",templateUrl:"/partials/hub.networkconnected.ng.html?version="+gui_version,controller:function($scope,$state,$http,$rootScope){authorization.username||$state.go("welcome.login",{}),$scope.dashboard=function(){$scope.connected?("enabled"==$scope.device.documentation_config&&$scope.initGetTutorials("True"),"enabled"==$scope.device.softsoc_config&&$scope.initGetFPGA("True"),$scope.initHubTasks("True")):("enabled"==$scope.device.documentation_config&&$scope.initGetTutorials("False"),"enabled"==$scope.device.softsoc_config&&$scope.initGetFPGA("False"),$scope.initHubTasks("False")),$state.go("hub.dashboard."+$scope.device.default_tab,{})}}})}),iotgatewayhub.config(function($stateProvider,$urlRouterProvider){$stateProvider.state("hub.networksettings",{url:"/hub/networksettings",templateUrl:"/partials/hub.networksettings.main.ng.html?version="+gui_version,scope:!1,controller:function($scope,$state,$http,$rootScope){$scope.cancelText="Skip",$scope.hideTestSettings=!0,$scope.maintainContextAfterSave=!1,$scope.skipSettings=function(){$state.go("hub.dashboard."+$scope.device.default_tab,{})},$scope.doneSuccessCallback=function(){$state.go("hub.networkconnected",{})}}})}),iotgatewayhub.config(function($stateProvider,$urlRouterProvider){$stateProvider.state("hub.nonetwork",{url:"/hub/nonetwork",templateUrl:"/partials/hub.nonetwork.ng.html?version="+gui_version,controller:function($scope,$state,$http,$rootScope){authorization.username||$state.go("welcome.login",{}),$scope.configureNetwork=function(){$scope.getProxySettings(function(){$state.go("hub.networksettings",{})})},$scope.skipConfigureNetwork=function(){$rootScope.loggedin=!0,$state.go("hub.dashboard."+$scope.device.default_tab,{})}}})}),iotgatewayhub.config(function($stateProvider,$urlRouterProvider){$stateProvider.state("hub.test",{url:"/hub/test",templateUrl:"/partials/hub.test.ng.html?version="+gui_version,controller:function($scope,$state,$http,$rootScope){bypass_auth||authorization.username||$state.go("welcome.login",{})}})}),iotgatewayhub.config(function($stateProvider,$urlRouterProvider){$stateProvider.state("tutorial",{url:"","abstract":!0,templateUrl:"/partials/hub.tutorial.ng.html?version="+gui_version,controller:function($scope,$state,$http,$rootScope,$uibModal){setupNoConnection(!0)}}).state("tutorial.sensorsetup",{url:"/tutorial/sensorsetup",templateUrl:"/partials/tutorial.sensorsetup.ng.html?version="+gui_version,controller:function($window,$scope,$state,$rootScope){authorization={}}}).state("tutorial.sensorcloud",{url:"/tutorial/sensorcloud",templateUrl:"/partials/tutorial.sensorcloud.ng.html?version="+gui_version,controller:function($window,$scope,$state,$rootScope){authorization={}}}).state("tutorial.helixapp",{url:"/tutorial/helixapp",templateUrl:"/partials/tutorial.helixapp.ng.html?version="+gui_version,controller:function($window,$scope,$state,$rootScope){authorization={}}}).state("tutorial.savedeploy",{url:"/tutorial/savedeploy",templateUrl:"/partials/tutorial.savedeploy.ng.html?version="+gui_version,controller:function($window,$scope,$state,$rootScope){authorization={}}}).state("tutorial.savedeploy_quark",{url:"/tutorial/savedeploy_quark",templateUrl:"/partials/tutorial.savedeploy_quark.ng.html?version="+gui_version,controller:function($window,$scope,$state,$rootScope){authorization={}}})}),iotgatewayhub.config(function($stateProvider,$urlRouterProvider){$stateProvider.state("welcome",{url:"","abstract":!0,templateUrl:"/partials/welcome.ng.html?version="+gui_version,controller:function($scope,$state,$http,$rootScope,$uibModal){setupNoConnection(!1),$rootScope.loggedin=!1,$scope.authentication={},$scope.connected=!1,$scope.broadcastFailure=function(bMessage){$scope.$broadcast(bMessage)},$scope.handleAuthenticated=function(){authorization={username:$scope.authentication.username},$rootScope.loggedin=!0,$rootScope.credentials={username:$scope.authentication.username,password:$scope.authentication.password},$rootScope.accepted_license?$state.go("hub.networkcheck",{}):$state.go("hub.license",{})},$scope.checkAuth=function(){var _method="POST",_uri="/api/validate_session";$http({method:_method,url:_uri,data:JSON.stringify(),headers:{"Content-type":"application/json"}}).then(function(response){"success"===response.data.status?(authorization={username:"preauthed"},$rootScope.loggedin=!0,$rootScope.accepted_license?$state.go("hub.networkcheck",{}):$state.go("hub.license",{})):$scope.showLogin=!0},function(response){$scope.showLogin=!0})},$scope.continueWelcomeLogin=function(){do_validate_session?$scope.checkAuth():$scope.showLogin=!0,do_validate_session=!0},$scope.setOEMBrandingCookiesNames=function(){for(oem_branding_cookies_names.length=0,i=0;i<oem_branding_eulas.length;i++){var temp_datetime="";i<oem_branding_eulas_datetime.length&&(temp_datetime=oem_branding_eulas_datetime[i]);var temp_cookiename=oem_branding_eulas[i].concat(temp_datetime);temp_cookiename=temp_cookiename.toLowerCase().replace(/[^a-zA-Z0-9]+/g,""),oem_branding_cookies_names.push(temp_cookiename)}},$scope.checkOEMBrandingCookies=function(){var temp_accepted=!0;for(i=0;i<oem_branding_cookies_names.length;i++)if(!getCookie(oem_branding_cookies_names[i])){temp_accepted=!1;break}$rootScope.accepted_license=temp_accepted},$scope.getOEMBranding=function(){$http({method:"GET",url:"/api/oembranding?nocache="+(new Date).getTime()}).then(function(response){try{"success"===response.data.status&&(oem_branding_logo_file=response.data.result.logo_file,oem_branding_eulas=response.data.result.eula_files,oem_branding_eulas_datetime=response.data.result.eula_files_datetime,$scope.setOEMBrandingCookiesNames(),$scope.checkOEMBrandingCookies())}catch(err){}$scope.continueWelcomeLogin()},function(response){$scope.continueWelcomeLogin()})},$scope.getOEMBranding()}})}),iotgatewayhub.config(function($stateProvider,$urlRouterProvider){$stateProvider.state("welcome.login",{url:"/welcome/login",templateUrl:"/partials/welcome.login.ng.html?version="+gui_version,controller:function($scope,$state,$http,$rootScope,$timeout,$window){authorization={},$scope.submitted=!1,$scope.showMessage=!1,$scope.showGo=!0,$scope.barMessage="Authenticating...",$scope.serverErrorMessage="A server error occurred! Refresh page and try again!",$scope.keyPressed=function($event){13==$event.keyCode&&$scope.login.username&&$scope.login.password&&$scope.login()},$scope.login=function(){$scope.showGo=!1;var internalAuthentication=function(firstTime){$scope.authentication={username:$scope.login.username,password:$scope.login.password};var _username=$scope.authentication.username,_password=$scope.authentication.password,do_auth="False";firstTime&&(do_auth="True"),$http({method:"POST",url:"/api/auth",data:JSON.stringify({username:_username,password:_password,do_auth:do_auth}),headers:{"Content-type":"application/json"}}).then(function(response){"success"===response.data.status?response.data.init_in_progress===!1?($scope.showGo=!0,$scope.handleAuthenticated()):(setTimeout(function(){internalAuthentication(!1)},rest_check_interval_milliseconds_m),$scope.barMessage="Waiting for server setup..."):$scope.broadcastFailure("welcome.loginFailed")},function(response){401==response.status?$scope.broadcastFailure("welcome.loginFailed"):408===response.status?setTimeout(function(){internalAuthentication(!1)},rest_check_interval_milliseconds_m):response.status===-1?($scope.serverErrorMessage="Cannot connect to the gateway yet! Try again after page is refreshed.",$scope.broadcastFailure("welcome.loginServerError"),setTimeout(function(){$window.location.reload()},4e3)):($scope.serverErrorMessage="A server error occurred! Try again after page is refreshed! ",$scope.broadcastFailure("welcome.loginServerError"),setTimeout(function(){$window.location.reload()},4e3))})};internalAuthentication(!0)},$scope.submit=function(){$scope.showMessage=!0},$scope.$on("welcome.loginFailed",function(){$scope.showGo=!0,$scope.showAuthenticationError=!0;var $animate=$(".container div div");$animate.addClass("shake"),setTimeout(function(){$animate.removeClass("shake")},100),$scope.login.password=null,$animate.addClass("invalid"),$animate.find("input").on("click",function(){$animate.removeClass("invalid"),$scope.showAuthenticationError=!1})}),$scope.$on("welcome.loginServerError",function(){$scope.showGo=!0,$scope.showServerError=!0,$timeout(function(){$scope.showServerError=!1},8e3),$(".login-form").find("input").on("click",function(){$scope.$apply(function(){$scope.showServerError=!1})})})}})}),iotgatewayhub.config(function($stateProvider,$urlRouterProvider){$stateProvider.state("welcome.privacy",{url:"/welcome/privacy",templateUrl:"/partials/welcome.privacy.ng.html?version="+gui_version,controller:function($scope,$state,$http,$rootScope,$uibModal,utilityFunctionsService){$scope.continueToLogin=function(){utilityFunctionsService.setCookie("privacy",!0,license_duration_days),$state.go("welcome.login")}}})}),iotgatewayhub.expandHub_gatewayOperations=function($scope,$http,$state,$timeout,$window){$scope.rebootGateway=function(_success,_error,timeout_value){$scope.stopCheckingNetwork(),$http({method:"PUT",url:"/api/osc",timeout:reboot_request_timeout_milliseconds}).then(function(response){$timeout(function(){do_validate_session=!1,$state.go("welcome.login")},timeout_value),_.isFunction(_success)&&_success(response)},function(response){$scope.startCheckingNetwork(),_.isFunction(_error)&&_error(response)})},$scope.scanUSBDevices=function(){$scope.scanning_usb=!0,$http({method:"GET",url:"/api/usb?nocache="+(new Date).getTime()}).then(function(response){$scope.usb_devices=response.data,$scope.scanning_usb=!1},function(response){$scope.scanning_usb=!0})},$scope.verifyFileExisted=function(file_path,passedSuccessCallback,passedErrorCallback){$http({method:"GET",url:"/api/file?path="+encodeURIComponent(file_path)+"&nocache="+(new Date).getTime()}).then(function(response){_.isFunction(passedSuccessCallback)&&passedSuccessCallback(response.data)},function(response){_.isFunction(passedErrorCallback)&&passedErrorCallback(response)})},$scope.getAccounts=function(passedSuccessCallback,passedErrorCallback){$http({method:"GET",url:"/api/accounts?nocache="+(new Date).getTime()}).then(function(response){_.isFunction(passedSuccessCallback)&&passedSuccessCallback(response.data);
},function(response){_.isFunction(passedErrorCallback)&&passedErrorCallback(response)})},$scope.logout=function(){var _method="GET",_uri="/api/auth?nocache="+(new Date).getTime();$http({method:_method,url:_uri,headers:{"Content-type":"application/json"}}).then(function(response){$state.go("welcome.login")},function(response){$state.go("welcome.login")})}},iotgatewayhub.expandHub_openOSUpdate=function($scope,$uibModal,$http,workerProcessRestService){$scope.enterOSCredential=function(){var modalInstance=$uibModal.open({templateUrl:"partials/hub.confirm.os.update.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){$scope.do_enter_credential=!0,$scope.do_confirm_update=!1,$scope.credentials={username:null,password:null},$scope.cancelOSUpdate=function(){$scope.informOSUpdate_CancelWarning(),modalInstance.dismiss("cancel")},$scope.continueChecking=function(){$scope.checkOSUpdate($scope.credentials),modalInstance.dismiss("cancel")}}})},$scope.checkOSUpdate=function(_credentials){var modalInstance=$uibModal.open({templateUrl:"partials/hub.inform.os.update.inprogress.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){$scope.title_message="OS Update: Checking in Progress",$scope.description_message="Please do not power-down the gateway. Will be auto-redirected to another page once checking is complete.",$scope.bar_before_message="Checking update availability...",$scope.bar_after_message=null,$scope.error_message=null,$scope.show_close_button=!1,"undefined"==typeof _credentials?content_body={type:"check",request:"rcpl"}:(content_body=_credentials,content_body.type="check",content_body.request="rcpl"),tempURL="/api/osup",workerProcessRestService.performGeneralExecution("POST",tempURL,!1,!0,content_body,function(data){"failure"===data.status?($scope.informOSUpdateError(data.message),modalInstance.dismiss("cancel")):($scope.foundOSUpdate=data.update,$scope.foundOSUpdate?($scope.confirmOSUpdate(_credentials),modalInstance.dismiss("cancel")):$scope.checkOSUpdate_Packages(modalInstance))},function(errorMessage){$scope.informOSUpdateError(errorMessage),modalInstance.dismiss("cancel")},rest_check_interval_milliseconds)}})},$scope.checkOSUpdate_Packages=function(modalInstance){content_body={type:"check",request:"package"},tempURL="/api/osup",workerProcessRestService.performGeneralExecution("POST",tempURL,!1,!0,content_body,function(data){"failure"===data.status?($scope.informOSUpdateError(data.message),modalInstance.dismiss("cancel")):($scope.foundOSUpdate_Packages=data.package_update,$scope.foundOSUpdate_Packages?($scope.OSUpdate_Packages=data.packages,$scope.confirmOSUpdatePackages(),modalInstance.dismiss("cancel")):($scope.informOSUpdateNotAvailable(),modalInstance.dismiss("cancel")))},function(errorMessage){$scope.informOSUpdateError(errorMessage),modalInstance.dismiss("cancel")},rest_check_interval_milliseconds)},$scope.confirmOSUpdate=function(_credentials){var modalInstance=$uibModal.open({templateUrl:"partials/hub.confirm.os.update.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){$scope.do_enter_credential=!1,$scope.do_confirm_update=!0,$scope.cancelOSUpdate=function(){$scope.informOSUpdate_CancelWarning(),modalInstance.dismiss("cancel")},$scope.doOSUpdate=function(){$scope.showOSUpdate(_credentials),modalInstance.dismiss("cancel")}}})},$scope.confirmOSUpdatePackages=function(){var modalInstance=$uibModal.open({templateUrl:"partials/hub.confirm.os.update.package.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){$scope.cancelOSUpdate=function(){$scope.informOSUpdate_CancelWarning(),modalInstance.dismiss("cancel")},$scope.doOSUpdate_Packages=function(){$scope.showOSUpdatePackages(),modalInstance.dismiss("cancel")}}})},$scope.showOSUpdate=function(_credentials){var modalInstance=$uibModal.open({templateUrl:"partials/hub.inform.os.update.inprogress.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){$scope.title_message="OS Update: Installation in Progress",$scope.isQuark===!0?$scope.description_message="Please do not power-down the gateway. The OS update is in progress, downloading updates and installing onto this gateway. The update takes several hours in most network conditions.":$scope.description_message="Please do not power-down the gateway. The OS update is in progress, downloading updates and installing onto this gateway. The update takes up to an hour in most network conditions.",$scope.bar_before_message="",$scope.bar_after_message="The gateway will automatically restart once update is complete.",$scope.error_message=null,$scope.show_close_button=!1,$scope.performUpdateSequence=function(){$scope.bar_before_message="Update in Progress...",$scope.error_message=null,content_body=_credentials,content_body.type="update_rcpl",tempURL="/api/osup",workerProcessRestService.performGeneralExecution("POST",tempURL,!1,!0,content_body,function(data){"success"===data.status?($scope.informOSUpdateRestart(),modalInstance.dismiss("cancel")):($scope.informOSUpdateError(data.message),modalInstance.dismiss("cancel"))},function(errorMessage){$scope.informOSUpdateError(errorMessage),modalInstance.dismiss("cancel")},rest_check_interval_milliseconds_ll)},$scope.performUpdateSequence()}})},$scope.showOSUpdatePackages=function(){var modalInstance=$uibModal.open({templateUrl:"partials/hub.inform.os.update.inprogress.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){$scope.title_message="OS Update: Installation in Progress",$scope.description_message="Please do not power-down the gateway. The OS update is in progress, downloading updates and installing onto this gateway. The updating time depends on the number of packages that need to be updated.",$scope.bar_before_message="",$scope.bar_after_message="The gateway will automatically restart once update is complete.",$scope.error_message=null,$scope.show_close_button=!1,content_body={type:"update_packages"},tempURL="/api/osup",workerProcessRestService.performGeneralExecution("POST",tempURL,!1,!0,content_body,function(data){if("success"===data.status){try{var p_list=JSON.parse(data.p_list);$scope.connected?$scope.setPackages("True",p_list):$scope.setPackages("False",p_list)}catch(e){}$scope.informOSUpdateRestart(),modalInstance.dismiss("cancel")}else $scope.informOSUpdateError(response.data.message),modalInstance.dismiss("cancel")},function(errorMessage){$scope.informOSUpdateError(errorMessage),modalInstance.dismiss("cancel")},rest_check_interval_milliseconds_l)}})},$scope.informOSUpdateRestart=function(){var modalInstance=$uibModal.open({templateUrl:"partials/hub.inform.os.update.end.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope,$timeout){$scope.title_message="OS Update: Installation Complete",$scope.description_message="",$scope.show_bar=!0,$scope.bar_before_message="Update Installed!",$scope.bar_after_message="The gateway will automatically restart in 10 seconds.",$scope.show_last_error=!1,$scope.show_last_normal=!0,$scope.show_close=!0,$scope.show_close_button=!1,$scope.show_warning_html=!1,$scope.closeModal=function(){modalInstance.dismiss("cancel")},$scope.rebootGateway(function(response){$timeout(function(){modalInstance.dismiss("cancel")},restart_welcome_latency_milliseconds-1e3)},function(response){$scope.bar_after_message="Rebooting gateway failed! Please manually restart the gateway!",$scope.show_last_error=!0,$scope.show_last_normal=!1},restart_welcome_latency_milliseconds)}})},$scope.informOSUpdateError=function(_error_message){var modalInstance=$uibModal.open({templateUrl:"partials/hub.inform.os.update.end.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){$scope.title_message="OS Update: Installation Error",$scope.description_message="",$scope.show_bar=!0,$scope.bar_before_message="Update Failed!",$scope.bar_after_message=_error_message,$scope.show_last_error=!0,$scope.show_last_normal=!1,$scope.show_close=!0,$scope.show_close_button=!1,$scope.show_warning_html=!1,$scope.closeModal=function(){modalInstance.dismiss("cancel")}}})},$scope.informOSUpdateNotAvailable=function(){var modalInstance=$uibModal.open({templateUrl:"partials/hub.inform.os.update.end.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){$scope.title_message="OS Update: No Update",$scope.description_message="",$scope.show_bar=!0,$scope.bar_before_message="Update Not Available!",$scope.bar_after_message="",$scope.show_last_error=!1,$scope.show_last_normal=!0,$scope.show_close=!1,$scope.show_close_button=!0,$scope.show_warning_html=!1,$scope.closeModal=function(){modalInstance.dismiss("cancel")}}})},$scope.informOSUpdateDone=function(){var modalInstance=$uibModal.open({templateUrl:"partials/hub.inform.os.update.end.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope,$timeout){$scope.title_message="OS Update: Installation Complete",$scope.description_message="",$scope.show_bar=!0,$scope.bar_before_message="Update Installed!",$scope.bar_after_message="",$scope.show_last_error=!1,$scope.show_last_normal=!0,$scope.show_close=!1,$scope.show_close_button=!0,$scope.show_warning_html=!1,$scope.closeModal=function(){modalInstance.dismiss("cancel")}}})},$scope.informOSUpdate_CancelWarning=function(){}},iotgatewayhub.expandHub_packages=function($scope,$state,$http,$rootScope,$uibModal,$timeout,workerProcessRestService){function basicInstallPackage(_name,_trust,successCallback,errorCallback){var _untrusted_query="&rpm=untrusted";tempURL="/api/packages?package="+encodeURIComponent(_name)+(_trust?_untrusted_query:""),workerProcessRestService.performGeneralExecution("POST",tempURL,!1,!1,null,successCallback,errorCallback,rest_check_interval_milliseconds_m)}function basicUninstallPackage(_name,successCallback,errorCallback){tempURL="/api/packages?package="+encodeURIComponent(_name),workerProcessRestService.performGeneralExecution("DELETE",tempURL,!1,!1,null,successCallback,errorCallback,rest_check_interval_milliseconds_m)}function basicUpdatePackage(_name,_trust,successCallback,errorCallback){var _untrusted_query="&rpm=untrusted";tempURL="/api/packages?package="+encodeURIComponent(_name)+(_trust?_untrusted_query:""),workerProcessRestService.performGeneralExecution("PUT",tempURL,!1,!1,null,successCallback,errorCallback,rest_check_interval_milliseconds_m)}function basicUpdateAllPackages(_trust,successCallback,errorCallback){var _untrusted_query="&rpm=untrusted";tempURL="/api/packages?package=all"+(_trust?_untrusted_query:""),workerProcessRestService.performGeneralExecution("PUT",tempURL,!1,!1,null,successCallback,errorCallback,rest_check_interval_milliseconds_l)}function basicSelfUpgrade(successCallback,errorCallback){tempURL="/api/selfupgrade",workerProcessRestService.performGeneralExecutionOnlySubmit("PUT",tempURL,!0,!1,null,successCallback,errorCallback)}function changePackageState(_package,state,blockSetArr,message){switch(state){case PACKAGE_STATE.INSTALLED:_package.installed=!0,$scope.installed_package[_package.name]=!0;break;case PACKAGE_STATE.UNINSTALLED:_package.installed=!1,$scope.installed_package[_package.name]=!1,_.remove($scope.installed,{name:_package.name}),blockSetArr||$scope.setArrays(!0);break;case PACKAGE_STATE.UPDATED:$scope.updating_package[_package.name]=!1,_package.version=_package.upgrade_version,_package.upgrade_version=null,$scope.updated_package[_package.name]=!0,blockSetArr||$scope.setArrays(!1);break;case PACKAGE_STATE.UPDATE_FAILED:"undefined"==typeof message?update_message="":update_message=message,$scope.updating_package[_package.name]=!1,$scope.update_package_failed[_package.name]=!0,$scope.update_package_fail_message[_package.name]=update_message}}var PACKAGE_ACTIVITY_TYPE={INSTALL:"INSTALL",UNINSTALL:"UNINSTALL",UPDATE:"UPDATE",UPDATE_ALL:"UPDATE_ALL",SELF_UPDATE:"SELF_UPDATE"},PACKAGE_STATE={INSTALLED:"INSTALLED",UNINSTALLED:"UNINSTALLED",UPDATED:"UPDATED",UPDATE_FAILED:"UPDATE_FAILED"};$scope.$on("packageActivityStart",function(opt,args){var $s=opt.currentScope,_type="NA",_name="NA";switch(args&&(_name=args[0]?args[0]:"",_type=args[1]?args[1]:""),$s.package_activity=!0,_type){case PACKAGE_ACTIVITY_TYPE.INSTALL:$s.installing_package[_name]=!0,$s.installing_any_package=!0;break;case PACKAGE_ACTIVITY_TYPE.UNINSTALL:$s.uninstalling_package[_name]=!0;break;case PACKAGE_ACTIVITY_TYPE.UPDATE:$s.updating_package[_name]=!0;break;case PACKAGE_ACTIVITY_TYPE.SELF_UPDATE:$s.selfUpgrading=!0,$s.updating_package[_name]=!0;break;case PACKAGE_ACTIVITY_TYPE.UPDATE_ALL:$s.installing_all_package_updates=!0}}),$scope.$on("packageActivityStop",function(opt,args){var $s=opt.currentScope,_type="NA",_name="NA";switch(args&&(_name=args[0]?args[0]:"",_type=args[1]?args[1]:""),$s.package_activity=!1,_type){case PACKAGE_ACTIVITY_TYPE.INSTALL:$s.installing_package[_name]=!1,$s.installing_any_package=!1;break;case PACKAGE_ACTIVITY_TYPE.UNINSTALL:$s.uninstalling_package[_name]=!1;break;case PACKAGE_ACTIVITY_TYPE.UPDATE:$s.updating_package[_name]=!1;break;case PACKAGE_ACTIVITY_TYPE.SELF_UPDATE:$s.selfUpgrading=!1,$s.updating_package[_name]=!1;break;case PACKAGE_ACTIVITY_TYPE.UPDATE_ALL:$s.installing_all_package_updates=!1}}),$scope.checkForPackageActivity=function(){return $scope.package_activity||$scope.installing_any_package},$scope.showPackageInfo=function(_package){tempURL="/api/packageinfo?name="+_package.name,workerProcessRestService.informGeneralChecking("GET",tempURL,!1,!1,null,_package.name,"","Getting Package Information...",function(data){var _details=data;for(var attrname in _details)_package[attrname]=_details[attrname];$scope.openPackageInfoModal(_package)},rest_check_interval_milliseconds_m)},$scope.installPackage=function(_package,_success,_error,_trust){var _name=_package.name;$scope.message="",_package.installed||$scope.checkForPackageActivity()||($rootScope.$broadcast("packageActivityStart",[_name,PACKAGE_ACTIVITY_TYPE.INSTALL]),basicInstallPackage(_name,_trust,function(data){if($rootScope.$broadcast("packageActivityStop",[_name,PACKAGE_ACTIVITY_TYPE.INSTALL]),"success"===data.status){changePackageState(_package,PACKAGE_STATE.INSTALLED);try{var p_list=JSON.parse(data.p_list);$scope.connected?$scope.setPackages("True",p_list):$scope.setPackages("False",p_list)}catch(e){}$timeout(function(){$scope.setArrays(!0),_.isFunction(_success)&&_success()},1500)}else"untrusted"!==data.status||_trust?($scope.openInstallPackageErrorModal("Package Install Error",_package,data.message),_.isFunction(_error)&&_error()):_package.confirmUntrusted=!0},function(errorMessage){$rootScope.$broadcast("packageActivityStop",[_name,PACKAGE_ACTIVITY_TYPE.INSTALL]),$scope.openInstallPackageErrorModal("Package Install Error",_package,errorMessage),_.isFunction(_error)&&_error()}))},$scope.uninstallPackage=function(_package){var _name=_package.name;$scope.message="",$scope.uninstalling_package[_package.name]||($rootScope.$broadcast("packageActivityStart",[_name,PACKAGE_ACTIVITY_TYPE.UNINSTALL]),basicUninstallPackage(_package.name,function(data){$scope.package_activity=!1,$scope.uninstalling_package[_package.name]=!1,changePackageState(_package,PACKAGE_STATE.UNINSTALLED),$rootScope.$broadcast("packageActivityStop",[_name,PACKAGE_ACTIVITY_TYPE.UNINSTALL]);try{var p_list=JSON.parse(data.p_list);$scope.connected?$scope.setPackages("True",p_list):$scope.setPackages("False",p_list)}catch(e){}},function(errorMessage){$scope.package_activity=!1,$scope.uninstalling_package[_package.name]=!1,$rootScope.$broadcast("packageActivityStop",[_name,PACKAGE_ACTIVITY_TYPE.UNINSTALL]),$scope.message=errorMessage,$scope.openInstallPackageErrorModal("Package Uninstall Error",_package,errorMessage)}))},$scope.launchPackage=function(_name,_url){var win=window.open(window.location.protocol+"//"+window.location.hostname+_url,"_blank");win.focus()},$scope.updatePackage=function(_package,_success,_error,_trust){function updateFailed(_package,errorMessage){$rootScope.$broadcast("packageActivityStop",[_name,PACKAGE_ACTIVITY_TYPE.UPDATE]),_.isFunction(_error)&&_error(errorMessage),changePackageState(_package,PACKAGE_STATE.UPDATE_FAILED,!1,errorMessage),$scope.update_package_failed[_package.name]=!0,$scope.update_package_fail_message[_package.name]=errorMessage,$timeout(function(){$scope.update_package_failed[_package.name]=!1},linger_info_timeout_milliseconds)}var _name=_package.name,_version=_package.upgrade_version;if(""!==_version){if("iot-developer-hub"===_package.name)return void $scope.openUpdateDevHubPackageModal(_package);$rootScope.$broadcast("packageActivityStart",[_name,PACKAGE_ACTIVITY_TYPE.UPDATE]),basicUpdatePackage(_name,_trust,function(data){if($rootScope.$broadcast("packageActivityStop",[_name,PACKAGE_ACTIVITY_TYPE.UPDATE]),"success"===data.status){if("p_info"in data){var _details=data.p_info;for(var attrname in _details)_package[attrname]=_details[attrname]}try{var p_list=JSON.parse(data.p_list);$scope.connected?$scope.setPackages("True",p_list):$scope.setPackages("False",p_list)}catch(e){}changePackageState(_package,PACKAGE_STATE.UPDATED),_.isFunction(_success)&&_success()}else{if("untrusted"===data.status&&!_trust)return void $scope.openUpdateUntrustedPackageModal(_package,data.error,_success);updateFailed(_package,data.message)}},function(errorMessage){updateFailed(_package,errorMessage)})}},$scope.updateDevHub=function(_package,_success,_error){$rootScope.$broadcast("packageActivityStart",[_package.name,PACKAGE_ACTIVITY_TYPE.SELF_UPDATE]),basicSelfUpgrade(function(data){$rootScope.$broadcast("packageActivityStop",[_package.name,PACKAGE_ACTIVITY_TYPE.SELF_UPDATE]),changePackageState(_package,PACKAGE_STATE.UPDATED),_.isFunction(_success)&&_success()},function(errorMessage){$rootScope.$broadcast("packageActivityStop",[_package.name,PACKAGE_ACTIVITY_TYPE.SELF_UPDATE]),_.isFunction(_error)&&_error(errorMessage),changePackageState(_package,PACKAGE_STATE.UPDATE_FAILED,!1,errorMessage),$scope.update_package_failed[_package.name]=!0,$scope.update_package_fail_message[_package.name]=errorMessage,$timeout(function(){$scope.update_package_failed[_package.name]=!1},linger_info_timeout_milliseconds)})},$scope.updatePackagesIndividually=function(_trust){function updateNextPackage(){return packagesToUpdate[i]?void $scope.updatePackage(packagesToUpdate[i],function(){i+=1,updateNextPackage()},function(errorMessage){$rootScope.$broadcast("packageActivityStop",[null,PACKAGE_ACTIVITY_TYPE.UPDATE_ALL]),$scope.openInstallPackageErrorModal("Package Update Error",packagesToUpdate[i],errorMessage+" Please refresh the web page to get updated packages information!")}):void(selfUpgradeAvailable&&$scope.openUpdateDevHubPackageModal(selfUpgradeAvailable))}var selfUpgradeAvailable=null,packagesToUpdate=[];if($rootScope.$broadcast("packageActivityStart",[null,PACKAGE_ACTIVITY_TYPE.UPDATE_ALL]),_.forEach($scope.packages,function(_package){_package.upgrade_version&&("iot-developer-hub"===_package.name?selfUpgradeAvailable=_package:packagesToUpdate.push(_package))}),packagesToUpdate.length<1)return void(selfUpgradeAvailable&&$scope.openUpdateDevHubPackageModal(selfUpgradeAvailable));var i=0;updateNextPackage()},$scope.updatePackages=function(_trust){function errorCallback(errorMessage){$rootScope.$broadcast("packageActivityStop",[null,PACKAGE_ACTIVITY_TYPE.UPDATE_ALL]);for(var _p=0,_pl=$scope.packages.length;_p<_pl;_p++){var _packg=$scope.packages[_p];changePackageState(_packg,PACKAGE_STATE.UPDATE_FAILED,!0,errorMessage)}$timeout(function(){for(var _p=0,_pl=$scope.packages.length;_p<_pl;_p++){var _packg=$scope.packages[_p];$scope.update_package_failed[_packg.name]=!1}},linger_info_timeout_milliseconds);var tempPackage={};tempPackage.name="Update Packages",$scope.openInstallPackageErrorModal("Packages Update Error",tempPackage,errorMessage)}var selfUpgradeAvailable=function(){var devHubPackage=_.find($scope.packages,function(_p){return"iot-developer-hub"===_p.name});return devHubPackage&&devHubPackage.upgrade_version?devHubPackage:null}();return selfUpgradeAvailable?void $scope.updatePackagesIndividually(_trust):void($scope.installing_all_package_updates||$scope.package_activity||($rootScope.$broadcast("packageActivityStart",[null,PACKAGE_ACTIVITY_TYPE.UPDATE_ALL]),_.forEach($scope.packages,function(_package){_package.upgrade_version&&($scope.updating_package[_package.name]=!0)}),basicUpdateAllPackages(_trust,function(data){if($rootScope.$broadcast("packageActivityStop",[null,PACKAGE_ACTIVITY_TYPE.UPDATE_ALL]),"success"===data.status){for(var _p=0,_pl=$scope.packages.length;_p<_pl;_p++)changePackageState($scope.packages[_p],PACKAGE_STATE.UPDATED,!0);try{var p_list=JSON.parse(data.p_list);$scope.connected?$scope.setPackages("True",p_list):$scope.setPackages("False",p_list)}catch(e){}$scope.setArrays(!1)}else{if("untrusted"===data.status&&!_trust)return void $scope.openUpdateUntrustedPackagesModal(data.error);errorCallback(data.message)}},errorCallback)))},$scope.setPackages=function(update,package_list,passedSuccessCallback,passedErrorCallback){"undefined"==typeof package_list||"string"==typeof package_list?$http({method:"GET",url:"/api/packages?update="+update+"&nocache="+(new Date).getTime()}).then(function(response){$scope.packages=response.data,$scope.package_refresh=Number($scope.package_refresh)+1,_.isFunction(passedSuccessCallback)&&passedSuccessCallback(response.data)},function(response){_.isFunction(passedErrorCallback)&&passedErrorCallback(response)}):($scope.packages=package_list,$scope.package_refresh=Number($scope.package_refresh)+1)},$scope.getPackagesInstalled=function(passedSuccessCallback,passedErrorCallback){$http({method:"GET",url:"/api/packages?request=installed&nocache="+(new Date).getTime()}).then(function(response){_.isFunction(passedSuccessCallback)&&passedSuccessCallback(response.data)},function(response){_.isFunction(passedErrorCallback)&&passedErrorCallback(response)})},$scope.openPackageInfoModal=function(_package){var modalInstance=$uibModal.open({templateUrl:"partials/hub.package.info.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){$scope.service_error=!1,$scope.displayed=_package,$scope.running=$scope.package_statuses[_package.name].running,$scope.enabled=$scope.package_statuses[_package.name].autorun,$scope.checkbox={enabled:$scope.enabled},$scope.hasupgrade=_package.upgrade_version,$scope.closePackageInfo=function(){modalInstance.dismiss("cancel"),$scope.installed_package={}},$scope.toggleServiceState=function(_enable){if(!$scope.enabling_package[_package.name]){$scope.enabling_package[_package.name]=!0;var _action=(_package.service.length,_enable?"enable":"disable"),_services=null;_package.service&&(_services=_package.service.join(","),_services&&(tempURL="/api/sc?services="+_services+"&action="+_action,workerProcessRestService.performGeneralExecution("POST",tempURL,!1,!1,null,function(data){$scope.enabling_package[_package.name]=!1,"success"===data.status?$scope.setArrays(!0):($scope.enabling_package[_package.name]=!1,$scope.service_error=!0,$scope.service_error_message="This action failed. Please try again! "+data.message,_enable?$scope.checkbox={enabled:!1}:$scope.checkbox={enabled:!0},setTimeout(function(){$scope.service_error=!1},linger_info_timeout_milliseconds))},function(errorMessage){$scope.enabling_package[_package.name]=!1,$scope.service_error=!0,$scope.service_error_message=errorMessage,_enable?$scope.checkbox={enabled:!1}:$scope.checkbox={enabled:!0},setTimeout(function(){$scope.service_error=!1},linger_info_timeout_milliseconds)},rest_check_interval_milliseconds_s)))}},$scope.doUpdate=function(_displayed){$scope.updatePackage(_displayed,function(){$scope.setArrays(!0)},function(errorMessage){$scope.openInstallPackageErrorModal("Package Update Error",_displayed,errorMessage),$scope.setArrays(!0),modalInstance.dismiss("cancel")})}}})},$scope.openUpdateUntrustedPackagesModal=function(_message){var modalInstance2=$uibModal.open({templateUrl:"partials/hub.update.untrusted.packages.ng.html?version="+gui_version,animation:!0,scope:$scope,size:"lg",backdrop:modal_light_dismiss_enabled,controller:function($scope,$state,$http,$rootScope,$timeout){$scope.message=_message,$scope.closeModal=function(){modalInstance2.dismiss("cancel")},$scope.trustToUpdate=function(){modalInstance2.dismiss("cancel"),$scope.updatePackages(!0)}}})},$scope.confirmUpdatePackages=function(){if(!$scope.package_activity)var modalInstance=$uibModal.open({templateUrl:"partials/hub.confirm.update.packages.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){$scope.closeModal=function(){modalInstance.dismiss("cancel")},$scope.doUpdatePackages=function(){modalInstance.dismiss("cancel"),$scope.updatePackages()}}})},$scope.openUpdateDevHubPackageModal=function(_package){var modalInstance=$uibModal.open({templateUrl:"partials/hub.confirm.update.devhub.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope,$timeout,$window){$rootScope.$broadcast("packageActivityStart"),$scope.selfUpgrading=!1,$scope.closeModal=function(){$rootScope.$broadcast("packageActivityStop"),modalInstance.dismiss("cancel")},$scope.doSelfUpdate=function(){$scope.selfUpgrading=!0,$scope.updateDevHub(_package,function(){$scope.stopCheckingNetwork(),$timeout(function(){modalInstance.dismiss("cancel"),$state.go("welcome.login")},5e3),setTimeout(function(){$window.location.reload()},7e3)},function(errorMessage){$timeout(function(){$scope.update_package_failed[_package.name]=!1},linger_info_timeout_milliseconds),$scope.openInstallPackageErrorModal("Package Update Error",_package,errorMessage),$timeout(function(){modalInstance.dismiss("cancel"),$state.go("welcome.login")},7e3),setTimeout(function(){$window.location.reload()},9e3)})}}})},$scope.startTrustedInstall=function(_package){_package.confirmUntrusted=!1,$scope.checkForPackageActivity()||$scope.installPackage(_package,null,null,!0)},$scope.openUpdateUntrustedPackageModal=function(_package,_message,_success){var modalInstance2=$uibModal.open({templateUrl:"partials/hub.update.untrusted.package.ng.html?version="+gui_version,animation:!0,scope:$scope,size:"lg",backdrop:modal_light_dismiss_enabled,controller:function($scope,$state,$http,$rootScope,$timeout){$scope.installed_package[_package.name]=!1,$scope.untrusted=_package,$scope.message=_message,$scope.closeModal=function(){modalInstance2.dismiss("cancel")},$scope.trustToUpdate=function(){modalInstance2.dismiss("cancel"),$scope.updatePackage(_package,_success,null,!0)}}})},$scope.openInstallUntrustedPackageModal=function(_package,_message){var modalInstance2=$uibModal.open({templateUrl:"partials/hub.install.untrusted.package.ng.html?version="+gui_version,animation:!0,scope:$scope,size:"lg",backdrop:modal_light_dismiss_enabled,controller:function($scope,$state,$http,$rootScope,$timeout){$scope.installed_package[_package.name]=!1,$scope.untrusted=_package,$scope.message=_message,$scope.closeModal=function(){modalInstance2.dismiss("cancel")},$scope.trustToInstall=function(){modalInstance2.dismiss("cancel"),$scope.installPackage(_package,function(){},function(){},!0)}}})},$scope.openInstallPackageErrorModal=function(_title,_package,_message){var modalInstance=$uibModal.open({templateUrl:"partials/hub.install.package.error.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,controller:function($scope,$state,$http,$rootScope,$timeout){$scope.title=_title,$scope["package"]=_package,$scope.message=_message,$scope.closeModal=function(){modalInstance.dismiss("cancel")}}})},$scope.openServiceActivityPackageErrorModal=function(_title,_message){var modalInstance=$uibModal.open({templateUrl:"partials/hub.service.package.error.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,controller:function($scope,$state,$http,$rootScope,$timeout){$scope.title=_title,$scope.message=_message,$scope.closeModal=function(){modalInstance.dismiss("cancel")}}})},$scope.openAddPackagesModal=function(){if(!$scope.package_activity)var modalInstance=$uibModal.open({templateUrl:"partials/hub.add.packages.ng.html?version="+gui_version,animation:!0,scope:$scope,size:"lg",backdrop:modal_light_dismiss_enabled,controller:function($scope,$state,$http,$rootScope){$scope.query=null,$scope.sortType="name",$scope.installed_package={},$scope.closeAddPackages=function(){$scope.installing_any_package||($scope.installed_package={},modalInstance.dismiss("cancel"))}}})}},iotgatewayhub.expandHub_pro_upgrade=function($scope,$http,$state,$uibModal,$timeout,workerProcessRestService,utilityFunctionsService){$scope.confirmOSUpgrade=function(callback){var modalInstance=$uibModal.open({templateUrl:"partials/hub.os.upgrade.1.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){$scope.onSuppress=function(shouldSuppress){shouldSuppress&&utilityFunctionsService.setCookie("upgradeMessage",!1,license_duration_days)},$scope.closeModal=function(){modalInstance.dismiss("cancel")},$scope.onNotNow=function(){modalInstance.dismiss("cancel"),angular.isFunction(callback)&&callback()},$scope.continueOSUpgrade=function(){return $scope.mec.enabled?($scope.openOSUpgradeModal1b(),void modalInstance.dismiss("cancel")):($scope.openOSUpgradeModal2(),void modalInstance.dismiss("cancel"))}}})},$scope.openOSUpgradeModal1b=function(){var modalInstance=$uibModal.open({templateUrl:"partials/hub.os.upgrade.1b.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){$scope.closeModal=function(){modalInstance.dismiss("cancel")}}})},$scope.openOSUpgradeModal2=function(){var modalInstance=$uibModal.open({templateUrl:"partials/hub.os.upgrade.2.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope,$timeout){$scope.credentials={username:null,password:null},$scope.error_message=null,$scope.closeModal=function(){modalInstance.dismiss("cancel")},$scope.continueOSUpgrade=function(){$scope.error_message="",$scope.openOSUpgradeModal3($scope.credentials.username,$scope.credentials.password),modalInstance.dismiss("cancel")}}})},$scope.openOSUpgradeModal3=function(_username,_password){var modalInstance=$uibModal.open({templateUrl:"partials/hub.os.upgrade.3.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){$scope.in_pro_upgrade=!0,$scope.before_bar_message="Upgrade in Progress...",$scope.button_title="Finish",$scope.isQuark===!0?$scope.timeHours="up to one hour":$scope.timeHours="less than one hour",$scope.closeModal=function(){modalInstance.dismiss("cancel")},data={username:_username,password:_password},workerProcessRestService.performGeneralExecution("POST","/api/pro",!1,!0,data,function(responseData){
$scope.in_pro_upgrade=!1,$scope.before_bar_message="Upgrade Complete!",$scope.button_title="Finish",$scope.rebooting=!1,$scope.rebooted=!1},function(errorMessage){$scope.in_pro_upgrade=!1,$scope.before_bar_message="Upgrade Failed!",$scope.button_title="Close",$scope.error_message=errorMessage},rest_check_interval_milliseconds_l)}})}},iotgatewayhub.expandHub_proxy=function($scope,$uibModal,$http,$rootScope,$state,workerProcessRestService,utilityFunctionsService){$scope.settings={proxy:null},$scope.proceedToNetworkCheck=function(){$rootScope.loggedin=!0,utilityFunctionsService.checkNetwork(function(response){var goNextState=function(has_network,data){var openErrorModal=function(_title,_message){if(!isLoadingErrorModalShown){var modalInstance=$uibModal.open({templateUrl:"partials/hub.loading.error.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,controller:function($scope,$state,$http,$rootScope,$timeout){$scope.title=_title,$scope.errorMessage=_message,$scope.closeModal=function(){isLoadingErrorModalShown=!1,modalInstance.dismiss("cancel")}}});modalInstance.opened.then(function(){isLoadingErrorModalShown=!0}),modalInstance.result.then(function(selectedItems){isLoadingErrorModalShown=!1},function(){isLoadingErrorModalShown=!1})}};has_network?($scope.connected=!0,"failure"===data.repo_status&&openErrorModal("Repositories Information Update Error",response.data.repo_error),$rootScope.redirectState?$state.go($rootScope.redirectState):$state.go("hub.dashboard."+$scope.device.default_tab)):($scope.connected=!1,"failure"===data.repo_status&&openErrorModal("Repositories Information Update Error",response.data.repo_error),$state.go("hub.nonetwork",{}))};$scope.startCheckingNetwork();var _https_conn=response.data.https_conn,_ok="True"==_https_conn;goNextState(_ok,response.data)},function(response){})},$scope.startCheckingNetwork=function(){null!==periodicCheckNetworkFunc&&clearInterval(periodicCheckNetworkFunc),periodicCheckNetworkFunc=setInterval(function(){utilityFunctionsService.checkNetwork(function(response){var _https_conn=response.data.https_conn,_ok="True"===_https_conn,_fail=simulate_network_failure&&network_index++%2===0;_ok&&!_fail?$scope.connected=!0:$scope.connected=!1,"NA"===response.data.pro_status.result||($scope.pro="True"===response.data.pro_status.result),"NA"===response.data.package_list||($scope.packages=JSON.parse(response.data.package_list),$scope.package_refresh=Number($scope.package_refresh)+1),"NA"===response.data.repo_list||response.data.repo_list&&($scope.repositories=response.data.repo_list)},function(response){})},network_check_interval_milliseconds)},$scope.stopCheckingNetwork=function(){null!==periodicCheckNetworkFunc&&clearInterval(periodicCheckNetworkFunc)},$scope.getProxySettings=function(resultHandler){var tempUrl="/api/proxy?request=list";workerProcessRestService.informGeneralChecking("GET",tempUrl,!1,!1,null,"Network Settings","","Retrieving Settings...",function(data){$scope.proxy=data,$scope.settings.proxy=$scope.proxy,$scope.settings.proxy.single_url="",$scope.settings.proxy.single_port="",resultHandler()},rest_check_interval_milliseconds)},$scope.testProxySettings=function(successCallback,failCallback){$scope.networkSettingsTest={running:!0},utilityFunctionsService.checkNetwork(function(response){var _https_conn=response.data.https_conn,_ok="True"==_https_conn;_ok?successCallback():failCallback({success:!1,message:"Proxy settings invalid ["+_https_conn+"]"})},function(response){failCallback()})},$scope.applyProxySettings=function(successCallback,failCallback){var _http_url=($scope.settings.proxy.single_url,$scope.settings.proxy.single_port,$scope.settings.proxy.http_url),_http_port=$scope.settings.proxy.http_port,_https_url=$scope.settings.proxy.https_url,_https_port=$scope.settings.proxy.https_port,_ftp_url=$scope.settings.proxy.ftp_url,_ftp_port=$scope.settings.proxy.ftp_port,_socks_url=$scope.settings.proxy.socks_url,_socks_port=$scope.settings.proxy.socks_port,_no_proxy=$scope.settings.proxy.no_proxy,tempURL="/api/proxy?http_url="+encodeURIComponent(_http_url)+"&http_port="+encodeURIComponent(_http_port)+"&https_url="+encodeURIComponent(_https_url)+"&https_port="+encodeURIComponent(_https_port)+"&ftp_url="+encodeURIComponent(_ftp_url)+"&ftp_port="+encodeURIComponent(_ftp_port)+"&socks_url="+encodeURIComponent(_socks_url)+"&socks_port="+encodeURIComponent(_socks_port)+"&no_proxy="+encodeURIComponent(_no_proxy);workerProcessRestService.performGeneralExecution("POST",tempURL,!1,!1,null,function(data){var _https_conn=data.https_conn;"True"===_https_conn?($scope.connected=!0,successCallback({success:!0,message:"Applied proxy settings"})):($scope.connected=!1,failCallback({success:!1,message:"Applied proxy settings, but https connection does not work under the settings. Some features will be disabled."}))},function(errorMessage){failCallback({success:!1,message:errorMessage})},rest_check_interval_milliseconds_m)}},iotgatewayhub.expandHub_repositories=function($scope,$http,$state,$uibModal,workerProcessRestService){$scope.openCreateRepositoryModal=function(){$scope.package_activity||(tempURL="/api/repository",workerProcessRestService.informGeneralChecking("GET",tempURL,!0,!1,null,"Manage Repositories","","Getting repositories list...",function(data){$scope.repositories=data.list,$scope.openCreateRepositoryModal_2()},rest_check_interval_milliseconds))},$scope.openCreateRepositoryModal_2=function(){var modalInstance=$uibModal.open({templateUrl:"partials/hub.manage.repositories.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http){$scope.hideCancel=!0,$scope.saveText="Save settings",$scope.updated_repositories=!1,$scope.updating_repositories=!1,$scope.removeRepository=function(_name){$scope.repositories=$scope.repositories.filter(function(_repo){return _repo.name!==_name})},$scope.findRepository=function(_name){for(var source=$scope.repositories,i=0;i<source.length;i++)if(source[i].name===_name)return source[i]},$scope.updateRepos=function(){$scope.deleting_any_repository||$scope.updating_repositories||$scope.updated_repositories||$scope.adding_repository||($scope.response_message=null,$scope.error_message=null,$scope.updating_repositories=!0,$scope.error_message_add=null,$scope.response_message_add=null,tempURL="/api/repository",workerProcessRestService.performGeneralExecution("PUT",tempURL,!0,!1,null,function(data){$scope.updating_repositories=!1,$scope.$emit("hub.unlockModal"),$scope.updated_repositories=!0;try{var p_list=JSON.parse(data.p_list);$scope.connected?$scope.setPackages("True",p_list):$scope.setPackages("False",p_list)}catch(err){}$scope.reponse_message="The repositories were successfully updated."},function(errorMessage){$scope.$emit("hub.unlockModal"),$scope.error_message=errorMessage,$scope.updating_repositories=!1},rest_check_interval_milliseconds_m),$scope.$emit("hub.lockModal",[$scope]))},$scope.addRepo=function(){if(!($scope.deleting_any_repository||$scope.adding_repository||$scope.updating_repositories)){$scope.adding_repository=!0,$scope.error_message=null,$scope.error_message_add=null,$scope.response_message=null,$scope.response_message_add=null;var _repository_name=$scope.newRepository.name,_repository_url=$scope.newRepository.url,_repository_username=$scope.newRepository.username,_repository_password=$scope.newRepository.password,_existing=$scope.findRepository(_repository_name);if(!_repository_name)return $scope.error_message_add="The repository name must be specified.",void($scope.adding_repository=!1);if(!_repository_url)return $scope.error_message_add="The repository url must be specified.",void($scope.adding_repository=!1);if(_existing)return $scope.error_message_add="The repository "+_repository_name+" already exists.",void($scope.adding_repository=!1);_repository_username||(_repository_username="None"),_repository_password||(_repository_password="None"),_repository_name&&_repository_url&&($scope.response_message_add="Adding repository "+_repository_name+". Package list will be updated. This may take a few minutes...",tempURL="/api/repository?name="+encodeURIComponent(_repository_name)+"&url="+encodeURIComponent(_repository_url)+"&username="+encodeURIComponent(_repository_username)+"&password="+encodeURIComponent(_repository_password),workerProcessRestService.performGeneralExecution("POST",tempURL,!1,!1,null,function(data){$scope.adding_repository=!1,$scope.response_message_add="",$scope.response_message_add="The repository "+_repository_name+" was successfully added. Package list was updated.",$scope.newRepository.name="",$scope.newRepository.url="";try{$scope.repositories.push(_repository_name)}catch(err){}try{var p_list=JSON.parse(data.p_list);$scope.connected?$scope.setPackages("True",p_list):$scope.setPackages("False",p_list)}catch(err){}$scope.$emit("hub.unlockModal",[$scope])},function(errorMessage){$scope.adding_repository=!1,$scope.response_message_add="",$scope.error_message_add=errorMessage,$scope.$emit("hub.unlockModal",[$scope])},rest_check_interval_milliseconds_m),$scope.$emit("hub.lockModal",[$scope]))}},$scope.closeModal=function(){$scope.adding_repository||$scope.updating_repositories||modalInstance.dismiss("cancel")},$scope.deleteRepo=function(_repository){$scope.deleting_any_repository||$scope.adding_repository||$scope.updating_repositories||($scope.error_message="",$scope.error_message_add=null,$scope.response_message_add=null,$scope.response_message=null,$scope.deleting_repository[_repository]=!0,$scope.deleting_any_repository=!0,tempURL="/api/repository?name="+encodeURIComponent(_repository),workerProcessRestService.performGeneralExecution("DELETE",tempURL,!1,!1,null,function(data){$scope.deleting_repository[_repository]=!1,$scope.deleting_any_repository=!1;try{var _index=$scope.repositories.indexOf(_repository);_index>=0&&$scope.repositories.splice(_index,1)}catch(err){}try{var p_list=JSON.parse(data.p_list);$scope.connected?$scope.setPackages("True",p_list):$scope.setPackages("False",p_list)}catch(err){}$scope.response_message="The repository "+_repository+" was successfully deleted."},function(errorMessage){$scope.deleting_repository[_repository]=!1,$scope.deleting_any_repository=!1,$scope.error_message=errorMessage},rest_check_interval_milliseconds_m))}}})}},iotgatewayhub.expandHub_save_image=function($scope,$http,$uibModal,workerProcessRestService){$scope.getDefaultConfigurationForSaveImage=function(passedSuccessCallback,passedErrorCallback){$http({method:"GET",url:"/api/sa?type=save_image_custom&nocache="+(new Date).getTime()}).then(function(response){_.isFunction(passedSuccessCallback)&&passedSuccessCallback(response.data)},function(response){_.isFunction(passedErrorCallback)&&passedErrorCallback(response)})},$scope.openOSImageModal0=function(){if($scope.mec)var modalInstance=$uibModal.open({templateUrl:"partials/hub.osimage.0.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){$scope.closeOSImageModal=function(){modalInstance.dismiss("cancel")},$scope.continueOSImage1=function(){$scope.openOSImageModal1(),modalInstance.dismiss("cancel")}}})},$scope.openOSImageModal1=function(){var modalInstance=$uibModal.open({templateUrl:"partials/hub.osimage.1.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){$scope.selected_device=null,$scope.closeOSImageModal=function(){modalInstance.dismiss("cancel")},$scope.setSelectedDevice=function(_device){$scope.selected_device=_device},$scope.continueOSImage2=function(){null!==$scope.selected_device&&($scope.openOSImageModal2($scope.selected_device),modalInstance.dismiss("cancel"))}}})},$scope.openOSImageModal2=function(_usb_device){var modalInstance=$uibModal.open({templateUrl:"partials/hub.osimage.2.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){$scope.selected_device=_usb_device,$scope.closeOSImageModal2=function(){modalInstance.dismiss("cancel")},$scope.continueOSImage3=function(){$scope.openOSImageModal3(_usb_device,!1),modalInstance.dismiss("cancel")}}})},$scope.openOSImageModal3=function(_usb_device,from_custom){var modalInstance=$uibModal.open({templateUrl:"partials/hub.osimage.3.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){var update_params={harden_type:"standard",usb_device:_usb_device,packages_removed:[],updaters:[],users:[],stig:[],new_admin_password:null,confirm_admin_password:null,new_mec_admin_password:null,confirm_mec_admin_password:null,enable_mec_whitelist:!0};$scope.parseVersion=function(){var sysVersionSplit=$scope.device.system_version.split("."),rcplVersion=sysVersionSplit[3];return rcplVersion<18?$scope.rcplLessThanEighteen=!0:$scope.rcplLessThanEighteen=!1,$scope.rcplLessThanEighteen},$scope.selection={type:"standard"},from_custom&&($scope.selection.type="custom"),$scope.closeOSImageModal3=function(){modalInstance.dismiss("cancel")},$scope.continueOSImage3=function(){if("standard"===$scope.selection.type)$scope.openOSImageModal3_Standard(update_params);else{var my_data={config_data:{},install_list:[],updaters_list:null,users_list:null,stig_list:null};$scope.openOSImageModal3_Custom_Packages(update_params,my_data)}modalInstance.dismiss("cancel")}}})},$scope.openOSImageModal3_Standard=function(_update_params){var modalInstance=$uibModal.open({templateUrl:"partials/hub.osimage.3.standard.pw.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){$scope.selected_device=_update_params.usb_device,$scope.error_message=null,$scope.hasMEC=function(){return"success"===$scope.mec.status},$scope.update_params=_update_params,$scope.update_params.harden_type="standard",$scope.closeOSImageModal3_Standard=function(){modalInstance.dismiss("cancel")},$scope.continueOSImage4_FromStandard=function(){return $scope.error_message=null,!$scope.update_params.new_admin_password||$scope.update_params.new_admin_password.length<min_password_length?void($scope.error_message="The admin password must be at least "+min_password_length+" characters long."):$scope.update_params.new_admin_password!==$scope.update_params.confirm_admin_password?void($scope.error_message="The admin passwords do not match"):!$scope.update_params.new_mec_admin_password||$scope.update_params.new_mec_admin_password.length<min_password_length?void($scope.error_message="The MEC admin password must be at least "+min_password_length+" characters long."):$scope.update_params.new_mec_admin_password!==$scope.update_params.confirm_mec_admin_password?void($scope.error_message="The MEC admin passwords do not match"):($scope.openOSImageModal4($scope.update_params),void modalInstance.dismiss("cancel"))}}})},$scope.openOSImageModal3_Custom_Packages=function(_update_params,_data){var modalInstance=$uibModal.open({templateUrl:"partials/hub.osimage.3.custom.packages.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){$scope.sortType="name",$scope.save_image_has_error=!1,$scope.save_image_error_message="",$scope.gettingPackages=!0,$scope.custom_configuration_data=_data.config_data,$scope.search_removed={remove:!0},$scope.search_packages={name:null},$scope.$watch("search_packages",function(){var container=document.getElementById("my_scroll_bar");container.scrollTop=0},!0),$scope.custom_installed_list=_data.install_list,0===$scope.custom_installed_list.length?$scope.getDefaultConfigurationForSaveImage(function(data){$scope.custom_configuration_data=data,$scope.getPackagesInstalled(function(data){data?$scope.processData(data):$scope.showError("The server is still processing the packages list. Please try again later.")},function(response){$scope.showError("Failed to get installed packages list! HTTP status is "+response.status)})},function(response){$scope.showError("Failed to get default configuration! HTTP status is "+response.status)}):$scope.gettingPackages=!1,$scope.processData=function(data){$scope.gettingPackages=!1;for(var key in data){var bEnforce=!1,bRemove=!1,lowerName=key.toLowerCase(),remove_dict={};"undefined"!=typeof $scope.custom_configuration_data.packages_removed&&(remove_dict=$scope.custom_configuration_data.packages_removed);for(var key2 in remove_dict){var value2=remove_dict[key2];lowerName===key2.toLowerCase()&&(bRemove=!0,bEnforce=value2)}$scope.custom_installed_list.push({name:key,remove:bRemove,enforce:bEnforce})}},$scope.showError=function(err_message){$scope.gettingPackages=!1,$scope.save_image_has_error=!0,$scope.save_image_error_message=err_message},$scope.clearSearchOSImageModal3_Custom=function(){$scope.search_packages.name=null},$scope.closeOSImageModal3_Custom=function(){modalInstance.dismiss("cancel")},$scope.backOSImageModal3_Custom=function(){$scope.openOSImageModal3(_update_params.usb_device,!0),modalInstance.dismiss("cancel")},$scope.continueOSImage3_Custom=function(){_update_params.harden_type="custom";var temp_removed_packages=$scope.custom_installed_list.filter(function(el){return el.remove===!0});_update_params.packages_removed=temp_removed_packages.map(function(a){return a.name}),_data.config_data=$scope.custom_configuration_data,_data.install_list=$scope.custom_installed_list,_data.updaters_list=null,$scope.openOSImageModal3_Custom_MEC(_update_params,_data),modalInstance.dismiss("cancel")}}})},$scope.openOSImageModal3_Custom_MEC=function(_update_params,_data){var modalInstance=$uibModal.open({templateUrl:"partials/hub.osimage.3.custom.mec.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){if($scope.sortType="name",$scope.updater_path=null,$scope.checkingFile=!1,$scope.save_image_has_error=!1,$scope.save_image_error_message="",$scope.search_not_deleted={"delete":!1},_data.updaters_list)$scope.custom_updaters_list=_data.updaters_list;else{var updaters_list=[];for("undefined"!=typeof _data.config_data.mec_updater&&(updaters_list=_data.config_data.mec_updater),$scope.custom_updaters_list=[],i=0;i<updaters_list.length;i++)$scope.custom_updaters_list.push({name:updaters_list[i],"delete":!1})}$scope.addSearchOSImageModal3_Custom=function(){$scope.checkingFile=!0,$scope.verifyFileExisted($scope.updater_path,function(data){if("success"===data.status){$scope.checkingFile=!1,$scope.save_image_has_error=!1,$scope.save_image_error_message="";var doesExist=!1;for(i=0;i<$scope.custom_updaters_list.length;i++)if($scope.custom_updaters_list[i].name===$scope.updater_path){$scope.custom_updaters_list[i]["delete"]?$scope.custom_updaters_list[i]["delete"]=!1:$scope.showError("The file is already in the list."),doesExist=!0;break}doesExist||$scope.custom_updaters_list.push({name:$scope.updater_path,"delete":!1})}else $scope.showError(data.message)},function(response){$scope.showError("Failed to verify file! HTTP status is "+response.status+".")})},$scope.showError=function(err_message){$scope.checkingFile=!1,$scope.save_image_has_error=!0,$scope.save_image_error_message=err_message,setTimeout(function(){$scope.save_image_has_error=!1,$scope.save_image_error_message="",$scope.$apply()},2500)},$scope.clearSearchOSImageModal3_Custom=function(){$scope.updater_path=null},$scope.closeOSImageModal3_Custom=function(){modalInstance.dismiss("cancel")},$scope.backOSImageModal3_Custom=function(){$scope.openOSImageModal3_Custom_Packages(_update_params,_data),modalInstance.dismiss("cancel")},$scope.continueOSImage3_Custom=function(){_update_params.harden_type="custom";var temp_updaters=$scope.custom_updaters_list.filter(function(el){return el["delete"]===!1});_update_params.updaters=temp_updaters.map(function(a){return a.name}),_data.updaters_list=$scope.custom_updaters_list,_data.users_list=null,$scope.openOSImageModal3_Custom_User(_update_params,_data),modalInstance.dismiss("cancel")}}})},$scope.openOSImageModal3_Custom_User=function(_update_params,_data){var modalInstance=$uibModal.open({templateUrl:"partials/hub.osimage.3.custom.users.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){$scope.sortType="sort_number",$scope.gettingAccount=!1,$scope.save_image_has_error=!1,$scope.save_image_error_message="",$scope.custom_users_list=[],_data.users_list?$scope.custom_users_list=_data.users_list:($scope.gettingAccount=!0,$scope.getAccounts(function(data){"success"===data.status?$scope.processData(data):$scope.showError("Failed to get accounts list! Error is "+data.message,!1)},function(response){$scope.showError("Failed to get accounts list! HTTP status is "+response.status,!1)})),$scope.processData=function(data){for($scope.gettingAccount=!1,$scope.custom_users_list.push({name:"McAfeeÂ® Embedded Control",sort_number:0,access:!0,expanded:!1,disable_toggle:!0,new_password:"",confirm_password:""}),i=0;i<data.accounts.length;i++){var sort_number=4,allow_access=!1;"root"===data.accounts[i]?(sort_number=1,allow_access=!0):"wra"===data.accounts[i]?(sort_number=2,allow_access=!0):"gwuser"===data.accounts[i]?(sort_number=3,allow_access=!0):(sort_number=4,allow_access=!1),$scope.custom_users_list.push({name:data.accounts[i],sort_number:sort_number,access:allow_access,expanded:!1,disable_toggle:!1,new_password:"",confirm_password:""})}},$scope.showError=function(err_message,do_time_out){$scope.gettingAccount=!1,$scope.save_image_has_error=!0,$scope.save_image_error_message=err_message,do_time_out&&setTimeout(function(){$scope.save_image_has_error=!1,$scope.save_image_error_message="",$scope.$apply()},2500)},$scope.closeOSImageModal3_Custom=function(){modalInstance.dismiss("cancel")},$scope.backOSImageModal3_Custom=function(){$scope.openOSImageModal3_Custom_MEC(_update_params,_data),modalInstance.dismiss("cancel")},$scope.continueOSImage3_Custom=function(){var hasError=!1,checkErrorMessage="";for(i=0;i<$scope.custom_users_list.length;i++)if($scope.custom_users_list[i].access){if(!$scope.custom_users_list[i].new_password||$scope.custom_users_list[i].new_password.length<min_password_length){checkErrorMessage="For account "+$scope.custom_users_list[i].name+", the password must be at least "+min_password_length+" characters long.",hasError=!0;break}if($scope.custom_users_list[i].new_password!==$scope.custom_users_list[i].confirm_password){checkErrorMessage="For account "+$scope.custom_users_list[i].name+", the passwords do not match.",hasError=!0;break}}if(hasError)$scope.showError(checkErrorMessage,!0);else{_update_params.harden_type="custom";var temp_users=$scope.custom_users_list.filter(function(el){return el.access===!0});_update_params.users=temp_users.map(function(a){return{name:a.name,pw:a.confirm_password}}),_data.users_list=$scope.custom_users_list,$scope.openOSImageModal4(_update_params),modalInstance.dismiss("cancel")}}}})},$scope.openOSImageModal3_Custom_stig=function(_update_params,_data){var modalInstance=$uibModal.open({templateUrl:"partials/hub.osimage.3.custom.stig.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){if($scope.sortType="ID",$scope.custom_stig_list=[],_data.stig_list)$scope.custom_stig_list=_data.stig_list;else if("stig_all"in _data.config_data){var temp_array=$.map(_data.config_data.stig_all,function(el,k){var el_return=el;return el_return.ID=k,el_return});for(i=0;i<temp_array.length;i++){var toInclude=!0;if("stig"in _data.config_data)try{toInclude=_data.config_data.stig.indexOf(temp_array[i].ID)!=-1}catch(err){}$scope.custom_stig_list.push({ID:temp_array[i].ID,Severity:temp_array[i].Severity,Title:temp_array[i].Title,URL:temp_array[i].URL,included:toInclude})}}$scope.closeOSImageModal3_Custom=function(){modalInstance.dismiss("cancel")},$scope.backOSImageModal3_Custom=function(){$scope.openOSImageModal3_Custom_User(_update_params,_data),modalInstance.dismiss("cancel")},$scope.continueOSImage3_Custom=function(){_update_params.harden_type="custom";var temp_stig=$scope.custom_stig_list.filter(function(el){return el.included===!0});_update_params.stig=temp_stig.map(function(a){return a.ID}),$scope.openOSImageModal4(_update_params),modalInstance.dismiss("cancel")}}})},$scope.openOSImageModal4=function(_update_params){var modalInstance=$uibModal.open({templateUrl:"partials/hub.osimage.4.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){$scope.closeOSImageModal4=function(){modalInstance.dismiss("cancel")},$scope.continueOSImage5=function(){$scope.openOSImageModal5(_update_params),modalInstance.dismiss("cancel")}}})},$scope.openOSImageModal5=function(_update_params){var modalInstance=$uibModal.open({templateUrl:"partials/hub.osimage.5.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){$scope.closeSaveImage=function(){modalInstance.dismiss("cancel")},$scope.savedImage=!1,$scope.saveImage=function(){tempURL="/api/sa",content_body={harden_type:_update_params.harden_type,usb_device:_update_params.usb_device.Device,packages_removed:_update_params.packages_removed,updaters:_update_params.updaters,users:_update_params.users,stig:_update_params.stig,admin_password:_update_params.new_admin_password,mec_password:_update_params.new_mec_admin_password},workerProcessRestService.performGeneralExecution("POST",tempURL,!1,!0,content_body,function(data){$scope.savedImage=!0,$scope.openOSImageModal6(),modalInstance.dismiss("cancel")},function(errorMessage){$scope.openOSImageModal6e(errorMessage),modalInstance.dismiss("cancel")},rest_check_interval_milliseconds_ll)},$scope.continueOSImage6=function(){$scope.openOSImageModal6(),modalInstance.dismiss("cancel")},$scope.saveImage()}})},$scope.openOSImageModal6=function(){var modalInstance=$uibModal.open({templateUrl:"partials/hub.osimage.6.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){$scope.closeModal=function(){modalInstance.dismiss("cancel")},$scope.continueOSImage7=function(){$scope.openOSImageModal7(),modalInstance.dismiss("cancel")}}})},$scope.openOSImageModal6e=function(_message){var modalInstance=$uibModal.open({templateUrl:"partials/hub.osimage.6e.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){$scope.message=_message,$scope.closeModal=function(){modalInstance.dismiss("cancel")}}})},$scope.openOSImageModal7=function(){var html_page="partials/hub.osimage.7.ng.html?version="+gui_version;$scope.isQuark&&(html_page="partials/hub.osimage.7.quark.ng.html?version="+gui_version);var modalInstance=$uibModal.open({templateUrl:html_page,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){$scope.closeModal=function(){modalInstance.dismiss("cancel")},$scope.openSaveDeployTutorial=function(){var url=$state.href("tutorial.savedeploy",{parameter:"parameter"});window.open(url,"_blank")},$scope.openDocumentation=function(){modalInstance.dismiss("cancel"),$state.go("hub.dashboard.documentation")}}})}},iotgatewayhub.expandHub_security=function($scope,$http,$uibModal,workerProcessRestService){$scope.confirmToggleSecurity=function(){var modalInstance=$uibModal.open({templateUrl:"partials/hub.confirm.toggle.security.ng.html?version="+gui_version,animation:!0,size:"lg",backdrop:modal_light_dismiss_enabled,scope:$scope,controller:function($scope,$state,$http,$rootScope){$scope.toggled_security=!1,$scope.closeModal=function(){modalInstance.dismiss("cancel")},$scope.toggleSecurity=function(){if(!$scope.toggling_security&&!$scope.toggled_security){$scope.toggling_security=!0;var _enable="true";$scope.security_enabled&&(_enable="false"),$scope.stopCheckingNetwork(),tempURL="/api/sa?enable="+_enable,workerProcessRestService.performGeneralExecution("PUT",tempURL,!1,!1,null,function(data){$scope.toggling_security=!1,$scope.toggled_security=!0,setTimeout(function(){$scope.security_enabled?window.location="http://"+window.location.hostname:window.location="https://"+window.location.hostname+":"+https_port},toggle_security_timeout_milliseconds)},function(errorMessage){$scope.toggling_security=!1,$scope.error_message=errorMessage,$scope.startCheckingNetwork()},rest_check_interval_milliseconds)}}}})}},iotgatewayhub.expandHub_services=function($scope,$http,$q,workerProcessRestService){$scope.serviceControl=function(_package,_action){var _services=_package.service,_name=_package.name;if(_services&&!$scope.package_activity){if("start"===_action){if($scope.starting_package[_name])return;$scope.starting_package[_name]=!0}else if("stop"===_action){if($scope.stopping_package[_name])return;$scope.stopping_package[_name]=!0}$scope.package_activity=!0;var _service_q=_services.join(",");tempURL="/api/sc?services="+_service_q+"&action="+_action,workerProcessRestService.performGeneralExecution("POST",tempURL,!1,!1,null,function(data){if($scope.starting_package[_name]=!1,$scope.stopping_package[_name]=!1,$scope.package_activity=!1,"success"===data.status){for(var _i=0,_len=_services.length;_i<_len;_i++){var _service=_services[_i];"start"===_action||"stop"===_action?$scope.service_statuses[_service].SUB="start"===_action?"Running":"not running":"enable"!==_action&&"disable"!==_action||($scope.service_statuses[_service].State="enable"===_action?"enabled":"disabled")}$scope.updatePackageStatuses()}else $scope.starting_package[_name]=!1,$scope.stopping_package[_name]=!1,$scope.package_activity=!1,$scope.openServiceActivityPackageErrorModal("Service Control Failure","The service control action failed. Please try again! "+data.message)},function(errorMessage){$scope.starting_package[_name]=!1,$scope.stopping_package[_name]=!1,$scope.package_activity=!1,$scope.openServiceActivityPackageErrorModal("Service Control Failure",errorMessage)},rest_check_interval_milliseconds_s)}},$scope.checkServiceStatuses=function(){for(var _services=Object.keys($scope.services),_service_calls=[],_i=0,_len=_services.length;_i<_len;_i++){_services[_i];_service_calls.push($http({method:"GET",url:"/api/sc?service="+_services[_i]+"&nocache="+(new Date).getTime()}))}$q.all(_service_calls).then(function(results){for(var _j=0,_len2=results.length;_j<_len2;_j++)for(var _result=results[_j],_object=_result.data,_services=Object.keys(_object),_num_serv=_services.length,_k=-0;_k<_num_serv;_k++){var _service_name=_services[_k],_service_status=_object[_service_name];"Running"===_service_status.SUB;$scope.service_statuses[_service_name]=_service_status}$scope.updatePackageStatuses()})},$scope.setServices=function(){$scope.services={},$scope.service_statuses={},$scope.package_statuses={};for(var _i=0,_len=$scope.packages.length;_i<_len;_i++){var _package=$scope.packages[_i];$scope.package_statuses[_package.name]={running:null,autorun:null},_package.running=!1,_package.autorun=!1;var _services=_package.service;if($scope.package_statuses[_package.name]=0,_services)for(_j=0;_j<_services.length;_j++){var _service=_services[_j];_service in $scope.services||($scope.services[_service]=[]),$scope.services[_service].push(_package.name)}}$scope.checkServiceStatuses()}};
//# sourceMappingURL=main.min.js.map
